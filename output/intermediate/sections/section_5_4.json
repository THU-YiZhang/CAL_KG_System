{
  "section_num": "5.4",
  "title": "差分放大电路",
  "start_line": 3497,
  "end_line": 3734,
  "content": "### 5.4 差分放大电路\n差分对是模拟集成电路中应用最广泛的一种基础线性单元结构,可视为一种特殊的组合电路。差分电路与普通组合放大电路的最大区别表现在对共模与差模信号的区分度上。 普通的组合电路对差模与共模信号同样放大,共模抑制比小,限制了电路的应用范围。差分放大电路对差模与共模区别对待, 理想情况下只放大差分信号, 完全抑制共模信号, 共模抑制比无穷大。差分对主要完成输入级 $V - I$ 转换,即跨导作用,经过中间级的电流信号处理,在输出级完成 $I - V$ 转换后获得电压输出,如图 5-19 所示。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_132_327_1648_955_143_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_132_327_1648_955_143_0.jpg)\n图 5-19 差分放大电路中的信号变换\n差分结构对共模信号的抑制是依靠共模反馈电阻 ${R}_{\\mathrm{S}}$ 以及电路结构和参数上的完全匹配对称而实现的。全对称型的双端输入一双端输出即全差分结构对抑制共模信号十分有效,而单端输出结构对共模信号的抑制仅由交流负反馈尾电阻 ${R}_{\\mathrm{S}}$ 的反馈作用实现。对于差模信号,共源点电位交流接地,电阻 ${R}_{\\mathrm{S}}$ 因短路而不起作用,因此, ${R}_{\\mathrm{S}}$ 反馈电阻对差模信号的增益没有抑制。差分对双端输出的差模增益与单级 CS 差模增益具有相同的约束关系。\n#### 5.4.1 差分输入级\n差分结构保持了差分交流小信号的增益,而有效抑制了输入共模信号的增益,使得电路可以处理不同共模电平偏置下的差模信号。以 NMOS 差分放大为例, 差分输入是在普通 CS 单级放大的基础上演化而来的。差模信号的动态范围将影响电路中各 MOS 管的工作状态, 对电路增益产生影响, 从而导致了电路信号处理的误差。因此, 输入差分信号的幅度必须限定在一定的范围内,即动态范围,而线性范围则是包含在动态范围之内的一局部区域。线性范围的大小与非线性失真的容差定义有关。\n基本的差分电路如图 5-20 所示, 匹配的输入差分对管其源端共接尾电流恒流源, 在两对称支路相同的负载上取差分电压输出, 构成全差分双端输出。尾电流源的主要作用是利用 ${R}_{\\mathrm{S}}$ 共模反馈电阻扩展输入信号的共模范围,降低共模增益并提高共模抑制比。在基本结构基础上, 采用电流镜传输方式将互补变化的电流由 MOS 二极管传递到输出管高阻支路上, 形成宽摆幅单端电压输出, 电路如图 5-21 所示。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_133_375_885_769_385_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_133_375_885_769_385_0.jpg)\n图 5-20 输入差分对的基本结构\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_133_363_1337_805_413_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_133_363_1337_805_413_0.jpg)\n图 5-21 单端输出的 $\\mathrm{N}/\\mathrm{P}$ 型差分输入对\n假设差分电路中的差模信号为 ${V}_{\\mathrm{i}d} = {V}_{\\mathrm{i}1} - {V}_{\\mathrm{i}2}$ ,共模信号为 ${V}_{\\mathrm{i}c} = \\left( {{V}_{\\mathrm{i}1} + {V}_{\\mathrm{i}2}}\\right) /2$ ,全差分电路中如果直接取半电路单端输出, 则输出电压变化损失一半, 全差分结构中的单端输出增益仅为差分增益的 $1/2$ 。同时,在全差分双端输出电路中,其单端输入的差分信号为 ${V}_{\\mathrm{{id}}}/2$ ,单端输出占双端输出电压变化的 $1/2$ ,则其单管 CS 增益与输入差分对的增益完全相同。\n在差分对的双端转单端输出结构中,由于负载电流镜的电流传输作用,差分对中一放大管的电流与电流镜负载电流极性相反,其差值为单个放大管电流的两倍。全差分输出与双端转单端输出相比,高阻负载上的电流变化量相同,这种双端转单输出具有与全差分输出完全相同的电压增益。因此, 差分电路的实质是以硬件资源和功耗增加为代价, 实现共模抑制比性能的提高。根据两差分对管的饱和条件,输出电流与差分输入电压 ${V}_{\\mathrm{{id}}}$ 的关系为 ${V}_{\\text{id }} = {V}_{\\mathrm{{GS}}1} - {V}_{\\mathrm{{GS}}2} = {\\Delta }_{1} - {\\Delta }_{2},\\Delta {I}_{\\mathrm{{DS}}} = {I}_{\\mathrm{{DS}}1} - {I}_{\\mathrm{{DS}}2},{I}_{\\mathrm{{DS}}1} + {I}_{\\mathrm{{DS}}2} = {I}_{\\mathrm{{SS}}\\text{ 。 }}$ . 又由于 ${\\Delta }_{1} = {\\left( 2{I}_{\\mathrm{{DS}}1}/k\\right) }^{1/2}$ 、 ${\\Delta }_{2} = {\\left( 2{I}_{\\mathrm{{DS}}2}/k\\right) }^{1/2}$ ,并得到 ${V}_{\\mathrm{{id}}}{}^{2}$ 与 ${I}_{\\mathrm{{DS}}1}\\text{、}{I}_{\\mathrm{{DS}}2}$ 的关系为\n$$\n{V}_{\\mathrm{{id}}}^{2} = \\frac{2{I}_{\\mathrm{{SS}}}}{k} - \\frac{4}{k}\\sqrt{{I}_{\\mathrm{{DS1}}}{I}_{\\mathrm{{DS}}2}} \\tag{5 - 34}\n$$\n利用 $4{I}_{\\mathrm{{DS}}1}{I}_{\\mathrm{{DS}}2} = {\\left( {I}_{\\mathrm{{DS}}1} + {I}_{\\mathrm{{DS}}2}\\right) }^{2} - {\\left( {I}_{\\mathrm{{DS}}1} - {I}_{\\mathrm{{DS}}2}\\right) }^{2} = {I}_{\\mathrm{{SS}}}{}^{2} - \\Delta {I}_{\\mathrm{{DS}}}{}^{2}$ 的数学关系,进一步整理后, 得到\n$$\n{I}_{\\mathrm{{SS}}}^{2} - {\\left( \\Delta {I}_{\\mathrm{{DS}}}\\right) }^{2} = \\frac{1}{4}{k}^{2}{V}_{\\mathrm{{id}}}^{4} - k{V}_{\\mathrm{{id}}}^{2}{I}_{\\mathrm{{SS}}} + {I}_{\\mathrm{{SS}}}^{2} \\tag{5 - 35}\n$$\n由此解出输出差分电流与差分输入电压之间的关系, 即\n$$\n\\Delta {I}_{\\mathrm{{DS}}} = \\frac{1}{2}k{V}_{\\mathrm{{id}}}\\sqrt{\\frac{4{I}_{\\mathrm{{SS}}}}{k} - {V}_{\\mathrm{{id}}}^{2}} = {V}_{\\mathrm{{id}}}\\sqrt{k{I}_{\\mathrm{{SS}}}} \\cdot  \\sqrt{1 - \\frac{k{V}_{\\mathrm{{id}}}^{2}}{4{I}_{\\mathrm{{SS}}}}} \\tag{5 - 36}\n$$\n根据式 (5-36) 计算得到的差分放大传输特性曲线如图 5-22 所示。结果表明, 差分输出电流与差分输入电压两者本质上是一种非线性关系。只有在小信号 ${V}_{\\mathrm{{id}}}$ 下,输出与输入近似为线性放大关系, 因此线性关系是有条件有范围的。线性范围与增益有关, 减小增益可以增加差模信号的线性区域。在大信号下,当 ${V}_{\\mathrm{{id}}}$ 增大到一定的程度时,一个放大管饱和,电流达到最大的 ${I}_{\\mathrm{{SS}}}$ ,而另一个放大管截止,处于典型的非线性工作状态。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_134_884_989_513_356_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_134_884_989_513_356_0.jpg)\n图 5-22 基本型差分对的传输特性\n由式(5 - 36)并根据 $\\Delta {I}_{\\mathrm{{DS}}} = {I}_{\\mathrm{{SS}}}$ 的条件,解出输入的上限范围为 ${V}_{\\mathrm{{id}}\\text{. max}} = {\\left( 2{I}_{\\mathrm{{SS}}}/k\\right) }^{1/2} =$ ${\\Delta }_{\\max } = \\sqrt{2\\Delta }$ 。 ${V}_{{id},\\max }$ 决定了差分输入的动态范围,其大小为 ${I}_{\\mathrm{{SS}}}$ 尾电流全部流过一个差分输入管而形成的栅过驱动电压。显然,当 ${V}_{\\mathrm{{id}}} > {V}_{\\mathrm{{id}},\\max }$ 时,差分对中的一条支路截止,另一条支路流过全部的尾电流,差分输入级进入非线性电阻工作区,增益下降。实际上,当 ${V}_{\\mathrm{{id}}} \\ll$ ${V}_{\\mathrm{{id}}\\text{.max }}$ 时,在接近最大动态临界范围的区域已呈现一定的非线性,只有在 ${V}_{\\mathrm{{id}}}$ 很小的范围内, 才具有良好的线性特性, 差分信号的线性范围比最大动态范围明显要小。\n根据差分对输出电流与差分电压间的变化关系,如不考虑失调,在 ${V}_{\\mathrm{{id}}} < {V}_{\\text{idmax }}$ 的动态范围内为小信号放大的工作状态,起到线性放大器的作用；而在 ${V}_{\\mathrm{{id}}} > {V}_{\\text{idmax }}$ 动态范围以外为大信号非线性工作区,低电平输出 ${V}_{\\mathrm{L}} = 0$ ,高电平输出 ${V}_{\\mathrm{H}} = {V}_{\\mathrm{{CC}}}$ ,差分放大电路起到比较器的作用。\n在动态小信号范围内的放大, 信号处理的线性度或非线性失真是一个关键指标。当差分信号相对动态范围仍很小时,并且利用 $\\left( {1 - {x}^{2}}\\right) 1/2 \\approx  1 - {x}^{2}/2$ 近似关系,得到\n$$\n\\Delta {I}_{\\mathrm{{DS}}} \\approx  \\sqrt{k{I}_{\\mathrm{{SS}}}}\\left( {{V}_{\\mathrm{{id}}} - \\frac{k}{8{I}_{\\mathrm{{SS}}}}{V}_{\\mathrm{{id}}}^{3}}\\right)  = {g}_{\\mathrm{m}}{V}_{\\mathrm{{id}}}\\left( {1 - \\frac{k}{8{I}_{\\mathrm{{SS}}}}{V}_{\\mathrm{{id}}}^{2}}\\right)  \\tag{5 - 37}\n$$\n式中 ${g}_{\\mathrm{m}}$ 为静态工作点下即 ${V}_{\\mathrm{{id}}} = 0$ 时差分输入对中任一单管的跨导参数。\n根据跨导参数的定义,基本差分对在整个动态范围内的跨导 ${G}_{\\mathrm{m}}$ 可表示为\n$$\n{G}_{\\mathrm{m}} = \\frac{\\partial \\Delta {I}_{\\mathrm{D}}}{\\partial {V}_{\\mathrm{{id}}}} = {g}_{\\mathrm{m}}\\frac{\\left( 1 - k{V}_{\\mathrm{{id}}}^{2}/2{I}_{\\mathrm{{SS}}}\\right) }{\\sqrt{1 - k{V}_{\\mathrm{{id}}}^{2}/\\left( {4{I}_{\\mathrm{{SS}}}}\\right) }} \\tag{5 - 38}\n$$\n显然, ${G}_{\\mathrm{m}}$ 与差分输入信号密切相关,表现出的非线性关系为差分电压增大,跨导下降, 同时增益也随之降低。只有在 ${V}_{\\mathrm{{id}}}$ 趋近于零的很小线性范围内,跨导变为线性常数,即 ${G}_{\\mathrm{m}} = {\\left( {I}_{\\mathrm{{SS}}}k\\right) }^{1/2} = {g}_{\\mathrm{m}}$ ,与普通单级增益中的 ${g}_{\\mathrm{m}}$ 关系相同。由于差分放大存在同相与反相两个输入端,因此,同相端的小信号差模电压增益为 ${A}_{\\mathrm{{vd}}} = {G}_{\\mathrm{m}}{R}_{\\mathrm{o}} \\approx  {g}_{\\mathrm{m}}{R}_{\\mathrm{o}}$ 。\n基本类型差分放大器的差模增益与普通 CS 电压放大器相同。若差分放大器的输出为低阻,则输出电压摆幅降低,输出驱动电流增大,但差分对因电压增益性能变差而不实用。 当输出为容性负载时,在低频下负载容抗很高,电路具有很高的电压增益。当频率增加后, 负载容抗下降导致电压增益衰减,此时实现的是电流放大。这种实现电流线性驱动功能的差分放大器,通常又称为线性跨导放大器 OTA。对 OTA 电路的基本要求首先是跨导 ${g}_{\\mathrm{m}}$ 值高,同时要求它的线性范围宽。OTA 对负载电容的最大驱动电流为 ${I}_{\\mathrm{{SS}}}$ ,因此最大压摆率 SR 受到差分对尾电流的限制。\n#### 5.4.2 输入失调电压\n失调影响电路的精度,形成固有偏差和失真,理想线性放大电路的输入失调电压为零。 在一般应用条件下, 需将失真降到最低。而在某些特殊场合, 可利用运放的失调完成一些特殊的控制和信号处理功能。\n当电路存在失调时,即使在输入信号匹配的条件下,差分电路输出级也可能偏离静态点甚至进入非线性饱和电阻区,就如同无失调的理想差分电路在 ${V}_{\\mathrm{{id}}}$ 差分输入下,使输出级产生相应的变化而偏离静态工作点或进入线性电阻区。对于实际运放, 将输出电压调节到静态工作点所需施加的差分输入信号 ${V}_{\\mathrm{{id}}}$ 定义为输入失调电压,输入失调电压是各类不匹配源对电路整体影响的综合体现。\n## 1)输入失调电压的形成\n失配是引起运放失调的主要因素,下面将以差分对为例分析失配对输入失调电压的影响。电路中的失配根据其形成机制和特点,可分为随机失配和系统失配两大类,与此对应的失调分别为随机失调与工艺失调。随机失配主要由器件参数的不对称变化引起,如 ${V}_{\\mathrm{{TH}}}$ 、 $W/L$ 的失配等,随机失配的重要特征是其大小和方向(正负)无法人为确定,与加工工艺的波动性有关。系统失真由电路工作点的失配引起, 而系统中各结点的工作点可以人为设计确定或干预, 因此其大小和方向都是可以控制的。\n随机失调由受工艺影响的相关器件参数变化或失配而引起,主要包括 ${V}_{\\mathrm{{TH}}}\\text{、}{k}^{\\prime }\\text{、}W/L$ 等参数。\n## (1)阈值电压失配引起的失调\n如图 5-21,差分输入级要求输入对管 ${\\mathrm{M}}_{1}$ 与 ${\\mathrm{M}}_{2}$ 匹配,同时电流镜负载对管 ${\\mathrm{M}}_{3}$ 和 ${\\mathrm{M}}_{4}$ 匹配。输入差分对管 ${V}_{\\mathrm{{TH}}}$ 的失配直接导致输入电流误差,该误差电流经过负载变换到输出电压后,再折算到输入,有\n$$\n{V}_{\\mathrm{{os}}} = \\frac{{V}_{\\mathrm{{os}},\\mathrm{{out}}}}{{A}_{\\mathrm{v}}} = \\frac{-{g}_{\\mathrm{m}1}\\Delta {V}_{\\mathrm{{TH}}1,2}{r}_{\\mathrm{o}}}{-{g}_{\\mathrm{m}1}{r}_{\\mathrm{o}}} = \\Delta {V}_{\\mathrm{{TH}}1,2} \\tag{5 - 39}\n$$\n利用 ${I}_{\\mathrm{{DS}}}/{g}_{\\mathrm{m}} = \\Delta /2$ 的关系,即在电流相同的条件下 ${g}_{\\mathrm{m}}\\Delta$ 为常数,则对于负载电流源对管 ${V}_{\\mathrm{{TH}}}$ 的失配,其等效到输入端的失调电压为\n$$\n{V}_{\\mathrm{{os}}} = \\frac{{V}_{\\mathrm{{os}},\\mathrm{{out}}}}{{A}_{\\mathrm{v}}} = \\frac{-{g}_{\\mathrm{m}3}\\Delta {V}_{\\mathrm{{TH}}3,4}{r}_{\\mathrm{o}}}{-{g}_{\\mathrm{{ml}}}{r}_{\\mathrm{o}}} = \\frac{{g}_{\\mathrm{m}3}}{{g}_{\\mathrm{m}1}}\\Delta {V}_{\\mathrm{{TH}}3,4} = \\frac{{\\Delta }_{1}}{{\\Delta }_{3}}\\Delta {V}_{\\mathrm{{TH}}3,4} \\tag{5 - 40}\n$$\n## (2)工艺因子失调\n根据 $\\partial {I}_{\\mathrm{{DS}}}/\\partial {k}^{\\prime } = \\left( {W/L}\\right) {\\Delta }^{2}/2 = {I}_{\\mathrm{{DS}}}/{k}^{\\prime }$ 定义,得到 $\\Delta {I}_{\\mathrm{{DS}}} = \\left( {\\Delta {k}^{\\prime }/{k}^{\\prime }}\\right) {I}_{\\mathrm{{DS}}}$ 关系,则\n$$\n{V}_{\\mathrm{{os}},{\\mathrm{k}}^{\\prime }} = \\frac{\\Delta {I}_{\\mathrm{{DS}}}{r}_{\\mathrm{o}}}{-{g}_{\\mathrm{{ml}}}{r}_{\\mathrm{o}}} =  - \\frac{\\Delta {I}_{\\mathrm{{DS}}}}{{g}_{\\mathrm{{ml}}}} =  - \\frac{{I}_{\\mathrm{{DS}}}}{{g}_{\\mathrm{{ml}}}}\\frac{\\Delta {k}^{\\prime }}{{k}^{\\prime }} =  - \\frac{\\Delta }{2}\\frac{\\Delta {k}^{\\prime }}{{k}^{\\prime }} \\tag{5 - 41}\n$$\n## (3)MOS 管 $W/L$ 失配引起的失调\n器件尺寸 $\\left( {W/L}\\right)$ 变化同样会引起电流的变化,其变化规律与 ${k}^{\\prime }$ 因子影响的规律相同, 即 $\\partial {I}_{\\mathrm{{DS}}}/\\partial \\left( {W/L}\\right)  = {I}_{\\mathrm{{DS}}}/\\left( {W/L}\\right)$ ,则 $W/L$ 失配引起的失调电压为\n$$\n{V}_{\\mathrm{{os}},\\mathrm{W}/\\mathrm{L}} = \\frac{\\Delta {I}_{\\mathrm{{DS}}}{r}_{\\mathrm{o}}}{-{g}_{\\mathrm{{ml}}}{r}_{\\mathrm{o}}} =  - \\frac{\\Delta \\left( {W/L}\\right) }{\\left( W/L\\right) }\\frac{{I}_{\\mathrm{{DS}}}}{{g}_{\\mathrm{{ml}}}} =  - \\frac{\\Delta }{2}\\frac{\\Delta \\left( {W/L}\\right) }{\\left( W/L\\right) } \\tag{5 - 42}\n$$\n定义差分对图形失配因子 ${M}_{\\mathrm{G}} = \\sum {\\left\\lbrack  \\Delta \\left( W/L\\right) /\\left( W/L\\right) \\right\\rbrack  }_{i}$ 。对于差分输入级, $i = 1$ 对应于输入对管的相对尺寸偏差, $i = 2$ 则对应为恒流源负载对管的尺寸偏差。同样,定义差分对工艺失配因子 ${M}_{\\mathrm{k}}{}^{\\prime } = \\sum {\\left\\lbrack  \\Delta {k}^{\\prime }/k\\right\\rbrack  }_{\\mathrm{i}}$ 。对于差分输入级, $i = 1$ 对应于输入对管的相对 ${k}^{\\prime }$ 因子偏差, $i = 2$ 则对应为恒流源负载对管的 ${k}^{\\prime }$ 因子偏差。 $\\partial {V}_{\\mathrm{{os}},\\mathrm{W}/\\mathrm{L}}/\\partial {V}_{\\mathrm{{GS}}} =  - {M}_{\\mathrm{G}/2},\\partial {V}_{\\mathrm{{os}},{\\mathrm{k}}^{\\prime }}/\\partial {V}_{\\mathrm{{GS}}}$ $=  - {M}_{{\\mathrm{k}}^{\\prime }/2}$ ,得到总的随机失调电压为\n$$\n{V}_{\\mathrm{{os}},\\mathrm{r}} = \\Delta {V}_{\\mathrm{{TH}}1,2} + \\frac{{\\left( {V}_{\\mathrm{{GS}}} - {V}_{\\mathrm{{TH}}}\\right) }_{1}}{{\\left( {V}_{\\mathrm{{GS}}} - {V}_{\\mathrm{{TH}}}\\right) }_{3}}\\Delta {V}_{\\mathrm{{TH}}3,4} - \\frac{{\\left( {V}_{\\mathrm{{GS}}} - {V}_{\\mathrm{{TH}}}\\right) }_{1,2}}{2}\\left\\lbrack  {{MG} + M{k}^{\\prime }}\\right\\rbrack   \\tag{5 - 43}\n$$\n降低 $\\mathrm{{MOS}}$ 管开启电压 ${V}_{\\mathrm{{TH}}}$ 失配以及图形失配,成为降低随机失调的关键所在。同时, 电路工作状态对随机失配也存在一定影响,应降低负载与输入差分对的跨导之比,同时降低输入差分对管静态工作点下的过驱动电压。\n系统失调由静态工作点失配而引起。电路中电流镜的 ${V}_{\\mathrm{{GS}}}$ 电压匹配,系统失调主要由电流镜 ${V}_{\\mathrm{{DS}}}$ 电压的不匹配 $\\Delta {V}_{\\mathrm{{DS}}}$ 而引起,并导致电流在的传输过程中产生误差。电流镜 $\\Delta {V}_{\\mathrm{{DS}}}$ 电压失配引入的电流失配 $\\Delta {I}_{\\mathrm{{DS}}} = {g}_{\\mathrm{d}}\\Delta {V}_{\\mathrm{{DS}}} = \\lambda {I}_{\\mathrm{{DS}}}\\Delta {V}_{\\mathrm{{DS}}}$ 。如图 5-21 中所示,设差分对有源负载中的 PMOS 输出管漏电位 ${V}_{1} = {V}_{\\mathrm{o}}$ ,与之对应的电流镜漏电位为 ${V}_{\\mathrm{y}}$ 。当电压 ${V}_{1}$ 与 ${V}_{\\mathrm{y}}$ 失配时, 产生的电流失配为\n$$\n\\Delta {I}_{\\mathrm{D}3} - \\Delta {I}_{\\mathrm{D}4} = {I}_{\\mathrm{D}5}{\\lambda }_{\\mathrm{p}}\\left\\lbrack  {{V}_{\\mathrm{{DD}}} - {V}_{\\mathrm{y}} - \\left( {{V}_{\\mathrm{{DD}}} - {V}_{1}}\\right) }\\right\\rbrack   = \\frac{{I}_{\\mathrm{{SS}}}}{2}{\\lambda }_{\\mathrm{p}}\\left( {{V}_{1} - {V}_{\\mathrm{y}}}\\right)  \\tag{5 - 44}\n$$\n同理,输入差分对管漏电位失配带来的电流失调为\n$$\n\\Delta {I}_{\\mathrm{D}1} - \\Delta {I}_{\\mathrm{D}2} = {I}_{\\mathrm{D}\\mathrm{S}}{\\lambda }_{\\mathrm{n}}\\left\\lbrack  {{V}_{\\mathrm{y}} - {V}_{\\mathrm{S}} - \\left( {{V}_{1} - {V}_{\\mathrm{S}}}\\right) }\\right\\rbrack   = \\frac{{I}_{\\mathrm{{SS}}}}{2}{\\lambda }_{\\mathrm{n}}\\left( {{V}_{\\mathrm{y}} - {V}_{1}}\\right)  \\tag{5 - 45}\n$$\n可见差分对与负载电流镜失调电流的变化方向相反,输出电流失配的净变化应为两者之差, 因此它们对输出电压变化的影响相同,由此引入的系统工作点失配而产生的输入失调为\n$$\n{V}_{\\mathrm{{os}},\\mathrm{s}} = \\frac{1}{{g}_{\\mathrm{{ml}}}}\\left\\lbrack  {\\left( {\\Delta {I}_{\\mathrm{D}3} - \\Delta {I}_{\\mathrm{D}4}}\\right)  - \\left( {\\Delta {I}_{\\mathrm{D}1} - \\Delta {I}_{\\mathrm{D}2}}\\right) }\\right\\rbrack   = \\frac{{I}_{\\mathrm{D}5}}{{g}_{\\mathrm{{ml}}}}\\left( {{\\lambda }_{\\mathrm{p}} + {\\lambda }_{\\mathrm{n}}}\\right) \\left( {{V}_{1} - {V}_{\\mathrm{y}}}\\right)\n$$\n$$\n= \\frac{{\\left( {V}_{\\mathrm{{GS}}} - {V}_{\\mathrm{{TH}}}\\right) }_{1,2}}{2}\\left( {{\\lambda }_{\\mathrm{n}} + {\\lambda }_{\\mathrm{p}}}\\right) \\left( {{V}_{1} - {V}_{\\mathrm{y}}}\\right)  \\tag{5 - 46}\n$$\n可见,减小系统失调的主要方法是降低 ${V}_{1}$ 和 ${V}_{\\mathrm{y}}$ 的电位失配,可通过 $W/L$ 与后级放大管的匹配设计使 ${V}_{1} = {V}_{\\mathrm{y}}$ 。此外,提高输出阻抗(降低 $\\lambda$ 值)、提高 ${\\left( W/L\\right) }_{1}$ (以降低过压驱动) 对降低系统失调也有一定作用。通常条件下,系统失调一般远低于随机失调。\n## 2)输入失调的影响\n开环运放的高增益依赖于高的输出阻抗,而高的输出阻抗导致输出共模点难以精确控制。设输出级为NMOS放大管的CS增益, PMOS恒流源提供有源负载,在静态工作点 ${V}_{\\mathrm{{GSNo}}}$ 的偏置下, NMOS 放大管同样表现为输出恒流特性。根据图 5-23(a) 显示的结果,当 ${V}_{\\mathrm{{GSN}}0}$ 设置恰当,即与 $\\mathrm{{PMOS}}$ 恒流输出相互匹配,使输出静态工作点位于 $\\mathrm{A}$ ,即 ${V}_{\\mathrm{o}}\\left( \\mathrm{A}\\right)  =$ ${V}_{\\mathrm{{CC}}}/2$ ,则当输入信号在此静态点有交流小信号输入时, ${I}_{\\mathrm{{DSN}}}$ 饱和电流响应变化。 ${V}_{\\mathrm{i}}$ 增加使 ${I}_{\\mathrm{{DSN}}}$ 增加,与 ${I}_{\\mathrm{{DSP}}}$ 的交点位置 $\\mathrm{A}$ 左移,输出电压下降；同样, ${V}_{\\mathrm{i}}$ 下降使 ${I}_{\\mathrm{{DSN}}}$ 减小,与 ${I}_{\\mathrm{{DSP}}}$ 的交点位置 $\\mathrm{A}$ 右移,输出电压增加。NMOS 与 PMOS 源漏电压 ${V}_{\\mathrm{{DS}}}$ 满足临界饱和所对应的输出电压范围,即构成了线性放大增益电路输出电压变化的动态范围。由此得到如下结论,首先,放大管与负载管的恒流特性越强,即输入阻抗越高,达到动态范围内的输出变化所需要的输入电压变化越小,增益越高；其次,为使以上 Class A 模式下的放大电路输出信号具有正负对称的输出摆幅,静态工作点应当设置在电源电压的中点。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_137_378_1280_835_332_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_137_378_1280_835_332_0.jpg)\n图 5-23 高阻负载输出电位变化\n因此,对于 Class A 放大器,输入增益管的静态偏置尤其重要。如果放大管与负载管的输出阻抗均无穷大,则两者饱和电流相同时的交点 $\\mathrm{A}$ 为无穷多,则静态工作点 ${V}_{\\mathrm{A}}$ 无定义； 当两管当中至少一个为有限阻抗,则可以获得一个惟一的 ${V}_{\\mathrm{A}}$ 交点,而当饱和电流略有变化时, ${V}_{\\mathrm{A}}$ 电位有很大的变化。显然,输出阻抗越高,增益越大,则输出静态点的控制难度越高。\n如果设置不当造成 NMOS 与 PMOS 恒流特性失配,则静态点可能偏离理想的位置。 如图 5-23(b) 中,若 ${V}_{\\mathrm{{GSN}}0}$ 偏大导致静态点偏移到较低的 $\\mathrm{B}$ 点位置; 同样,若 ${V}_{\\mathrm{{GSN}}0}$ 偏小则静态点偏移到较高的 $\\mathrm{C}$ 点位置。静态工作点偏离理想的 $\\mathrm{A}$ 点位置后,在 Class $\\mathrm{A}$ 的工作模式下, 造成输出动态范围减小, 失真增加。\n抑制输出共模静态点漂移的根本方法在于降低支路的输出阻抗, 负载可采用无源线性电阻 ${R}_{\\mathrm{L}}$ 或非线性 MOS 二极管电阻。如图 5-24 所示,设置负载 ${R}_{\\mathrm{L}}$ 的大小可很方便地将 $\\mathrm{A}$ 点设置在电源中点附近; 而对于 $1/{g}_{\\mathrm{{mL}}}$ 的负载结构,由于 $\\mathrm{{MOS}}$ 二极管的钳位作用,输出静态点钳制在距离 ${V}_{\\mathrm{{CC}}}$ 的 ${V}_{\\mathrm{{TP}}} + {\\Delta }_{\\mathrm{p}}$ 附近,动态范围和增益明显减小,但静态点的设置更为方便。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_138_319_458_891_282_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_138_319_458_891_282_0.jpg)\n图 5-24 低阻负载输出电位变化\n在高阻负载下, 当输出共模信号静态点发生漂移时, 需要采取外部控制的方式使工作点设置到所需的位置。其控制的基本原理在于改变恒流源的电流值, 具体有两种实现方式。 一种是改变放大管的输入电压,调节放大管的电流使输出静态点改变,对于差分电路即需要施加一定的差分输入电压使输出定位在所需要的静态点,此差分输入电压即为运放的失调。 另一种是改变负载恒流源的偏置, 通过调节负载电流使静态点达到所需位置。在全差分电路中,通常是采用这种方式实现共模负反馈,稳定设置差分输出的共模静态点。\n差分放大器一般用于闭环负反馈系统。以电压串联负反馈为例, 若输出通过反馈网络反馈到运放的反相输入端,则运放输出电位由同相端输入信号定义。通常该输出点在运放理想静态点附近, 则所需的输入差分电压为输出与静态点的变化量与增益的比, 即输入分辨率；否则,当电路存在失调时,首先需要在输入端施加失调量的差分输入电压,使电路进入线性工作区,再叠加有效的差分输入电压后,将输出调节到所需的状态。显然,当运放输入失调远大于信号的分辨率时,将使运放的控制精度下降,引入较大的失真。\n#### 5.4.3 共模抑制比 CMRR\n运放相对于普通组合放大电路的最显著优点是输入共模范围大,共模抑制比高,因此提高运放的共模抑制比至关重要。当共模信号从差分对管的栅极输入时,高的 CMRR 可争取到足够的差模信号摆幅空间。当共模信号从差分对管的漏或源感应输入时,高的 CMRR 即对应于高的 ${\\mathrm{{PSRR}}}_{\\mathrm{{VDD}}}$ 和 ${\\mathrm{{PSRR}}}_{\\mathrm{{VSS}}}$ ,可显著降低电源噪声的影响,提高电源和地的噪声抑制比。CMRR 可定义为差模增益 ${A}_{\\mathrm{{vd}}}$ 与共模增益 ${A}_{\\mathrm{{vc}}}$ 之比。理想运放由于 ${A}_{\\mathrm{{vc}}} = 0$ 则 CMRR 趋近无穷大。然而,实际运放中由于对称结构中存在的各种失配影响, ${A}_{\\mathrm{{vc}}}$ 增加导致 CMRR 下降。因此, CMRR 与运放失配的关系为\n$$\n\\mathrm{{CMRR}} = \\frac{{A}_{\\mathrm{{vd}}}}{{A}_{\\mathrm{{vc}}}} = \\frac{{V}_{\\mathrm{{od}}}/{V}_{\\mathrm{{id}}}}{{V}_{\\mathrm{{oc}}}/{V}_{\\mathrm{{ic}}}} = \\frac{{V}_{\\mathrm{{ic}}}}{{V}_{\\mathrm{{oc}}}/{A}_{\\mathrm{{vd}}}} = \\frac{{V}_{\\mathrm{{ic}}}}{{V}_{\\mathrm{{os}},\\mathrm{{cm}}}} = {\\left( \\frac{\\partial {V}_{\\mathrm{{os}}}}{\\partial {V}_{\\mathrm{{ic}}}}\\right) }^{-1} \\tag{5 - 47}\n$$\n式中: ${V}_{\\mathrm{{ic}}}$ ——输入共模信号； ${V}_{\\infty }$ ——共模输出信号。\n在输入 ${V}_{\\mathrm{{id}}}$ 短路条件下,共模输出 ${V}_{\\mathrm{{oc}}}$ 由于是失调引起,则其等效到输入的差模失调电压 ${V}_{\\mathrm{{in}},\\mathrm{{CM}}} = {V}_{\\mathrm{{oc}}}/{A}_{\\mathrm{{vd}}},{V}_{\\mathrm{{ic}}}$ 与 ${V}_{\\mathrm{{os}},\\mathrm{{cm}}}$ 的比例关系决定了电路的 CMRR 特性。也就是说电路失配引入的输入失调,将大幅度降低电路的 CMRR 性能。根据不同的失配贡献, CMRR 为各失配条件下 ${\\mathrm{{CMRR}}}_{\\mathrm{i}}$ 的并联求和,即\n$$\n\\frac{1}{\\mathrm{{CMRR}}} = \\frac{\\partial {V}_{\\mathrm{{os}}}}{\\partial {V}_{\\mathrm{{ic}}}} = \\frac{\\partial {V}_{\\mathrm{{os}},\\mathrm{r}}}{\\partial {V}_{\\mathrm{{ic}}}} + \\frac{\\partial {V}_{\\mathrm{{os}},\\mathrm{s}}}{\\partial {V}_{\\mathrm{{ic}}}} = \\frac{1}{{\\mathrm{{CMRR}}}_{\\mathrm{r}}} + \\frac{1}{{\\mathrm{{CMRR}}}_{\\mathrm{s}}} \\tag{5 - 48}\n$$\n## 1)系统失配下的 CMRRs\n如图 5-21(a) 所示,根据 ${\\mathrm{M}}_{5}$ 管交流电阻 ${R}_{\\mathrm{S}}$ 对共模信号的交流负反馈控制作用,共模信号的有效跨导为 ${G}_{\\mathrm{m}} = {g}_{\\mathrm{{ml}}}/\\left( {1 + 2{g}_{\\mathrm{{ml}}}{R}_{\\mathrm{S}}}\\right)  \\approx  1/\\left( {2{R}_{\\mathrm{S}}}\\right)$ ,则由定义直接得到由系统工作点失配决定的 CMRR 为\n$$\n\\text{ CMRRs } \\approx  \\frac{{g}_{\\mathrm{m}1}\\left( {{r}_{\\mathrm{o}2}//{r}_{\\mathrm{o}4}}\\right) }{1/\\left( {2{R}_{\\mathrm{S}}}\\right)  \\cdot  1/{g}_{\\mathrm{m}3}} = 2{R}_{\\mathrm{S}}{g}_{\\mathrm{m}1}{g}_{\\mathrm{m}3}\\left( {{r}_{\\mathrm{o}2}//{r}_{\\mathrm{o}4}}\\right)  \\tag{5 - 49}\n$$\n从电流失配的角度分析,由差分对栅极输入的共模电压 ${V}_{\\mathrm{{ic}}}$ 引起尾电流的变化并传递到 ${\\mathrm{M}}_{1}/{\\mathrm{M}}_{2}$ 差分对中,有 ${i}_{\\mathrm{d}1} = {i}_{\\mathrm{d}2} \\approx  {i}_{\\mathrm{x}} = {V}_{\\mathrm{{ic}}}/\\left( {2{R}_{\\mathrm{S}}}\\right) 。{i}_{\\mathrm{d}1}$ 和 ${i}_{\\mathrm{d}2}$ 电流变化后,导致差分对管的 ${V}_{\\mathrm{D}}$ 漏电位即 ${\\mathrm{M}}_{3}$ 管的 ${V}_{\\mathrm{G}}$ 栅电位发生相应变化,而 ${\\mathrm{M}}_{3}$ 管栅压的变化又引起自身电流的改变。由于电流连续, 电流变化的方向一致, 即\n$$\n{g}_{\\mathrm{m}3}\\Delta {V}_{\\mathrm{x}} + {g}_{\\mathrm{y}}\\Delta {V}_{\\mathrm{x}} = \\left( {{g}_{\\mathrm{m}3} + {g}_{\\mathrm{o}1} + {g}_{\\mathrm{o}3}}\\right) \\Delta {V}_{\\mathrm{x}} = {i}_{\\mathrm{d}1} = {i}_{\\mathrm{d}3} \\tag{5-50}\n$$\n而 ${\\mathrm{M}}_{4}$ 中的电流变化主要从 ${\\mathrm{M}}_{3}$ 的变化电流感应得到,设 $1/{r}_{\\mathrm{y}} = {g}_{\\mathrm{y}} = {g}_{\\mathrm{o}1} + {g}_{\\mathrm{o}3}$ ,得\n$$\n{i}_{\\mathrm{d}4} = \\frac{{r}_{\\mathrm{y}}}{{r}_{\\mathrm{y}} + 1/{g}_{\\mathrm{m}3}}{i}_{\\mathrm{d}3} = \\frac{{r}_{\\mathrm{y}}}{{r}_{\\mathrm{y}} + 1/{g}_{\\mathrm{m}3}}{i}_{\\mathrm{d}1} \\tag{5 - 51}\n$$\n则差模输出电压 $\\Delta {I}_{\\mathrm{{DS}}} = {i}_{\\mathrm{d}4} - {i}_{\\mathrm{d}2} = {i}_{\\mathrm{d}4} - {i}_{\\mathrm{d}1} = {i}_{\\mathrm{d}1}\\left( {{i}_{\\mathrm{d}4}/{i}_{\\mathrm{d}1} - 1}\\right)$ ,代入上式后得\n$$\n\\Delta {I}_{\\mathrm{{DS}}} = \\frac{-\\left( {1/{g}_{\\mathrm{m}3}}\\right) {i}_{\\mathrm{d}1}}{{r}_{\\mathrm{y}} + 1/{g}_{\\mathrm{m}3}} =  - \\frac{{i}_{\\mathrm{d}1}}{1 + {g}_{\\mathrm{m}3}{r}_{\\mathrm{y}}} \\approx   - \\frac{{i}_{\\mathrm{d}1}}{{g}_{\\mathrm{m}3}{r}_{\\mathrm{y}}} \\tag{5 - 52}\n$$\n该失调电流在负载上形成的输出电压为 ${V}_{\\text{out, os,}\\mathrm{{cm}}} = \\Delta {I}_{\\mathrm{D}}{r}_{\\mathrm{o}} = \\left( {{i}_{\\mathrm{d}4} - {i}_{\\mathrm{d}2}}\\right) {r}_{\\mathrm{o}}$ ,输出失调电压等效到输入端后, 得到的等效输入失调电压为\n$$\n{V}_{\\mathrm{{os}},\\mathrm{{cm}}} = \\frac{{V}_{\\mathrm{{out}},\\mathrm{{os}},\\mathrm{{cm}}}}{{A}_{\\mathrm{v}}} = \\frac{\\left( {{i}_{\\mathrm{d}4} - {i}_{\\mathrm{d}2}}\\right) {r}_{\\mathrm{o}}}{-{g}_{\\mathrm{m}1}{r}_{\\mathrm{o}}} =  - \\frac{-1/\\left( {{g}_{\\mathrm{m}3}{r}_{\\mathrm{y}}}\\right) }{{g}_{\\mathrm{{ml}}}}{i}_{\\mathrm{{dl}}} = \\frac{1}{{g}_{\\mathrm{m}1}{g}_{\\mathrm{m}3}\\left( {{r}_{\\mathrm{o}1}//{r}_{\\mathrm{o}3}}\\right) }\\frac{{V}_{\\mathrm{{ic}}}}{2{R}_{\\mathrm{S}}}\n$$\n(5 - 53)\n根据中低频率下共模抑制比与等效输入失调的关系, 计算得到由系统失配引起的 ${\\mathrm{{CMRR}}}_{\\mathrm{S}} = 2{g}_{\\mathrm{m}1}{g}_{\\mathrm{m}3}{R}_{\\mathrm{S}}\\left( {{r}_{\\mathrm{o}1}//{r}_{\\mathrm{o}3}}\\right)$ ,得到与电压模分析方式相同的结果。\n## 2)随机失配下的 CMRRr\n根据随机失调 ${V}_{\\mathrm{{os}},\\mathrm{r}}$ 与电路静态工作点状态和输入共模信号 ${V}_{\\mathrm{{ic}}}$ 的关系,即\n$$\n{\\left( \\mathrm{{CMRRr}}\\right) }^{-1} = \\frac{\\partial {V}_{\\mathrm{{os}},\\mathrm{r}}}{\\partial {V}_{\\mathrm{{ic}}}} = \\frac{\\partial {V}_{\\mathrm{{os}},\\mathrm{r}}}{\\partial {V}_{\\mathrm{{GSl}}}}\\frac{\\partial {V}_{\\mathrm{{GSl}}}}{\\partial {I}_{\\mathrm{{Dl}}}}\\frac{\\partial {I}_{\\mathrm{{Dl}}}}{\\partial {V}_{\\mathrm{{ic}}}} \\tag{5 - 54}\n$$\n根据式 (5-43) 的失配参数关系,得到\n$$\n\\frac{\\partial {V}_{\\mathrm{{os}},\\mathrm{r}}}{\\partial {V}_{\\mathrm{{GS1}}}} = \\frac{\\partial {V}_{\\mathrm{{os}},\\mathrm{r}}}{\\partial {\\Delta }_{1}} = \\frac{\\Delta {V}_{\\mathrm{{TH}}3,4}}{{\\Delta }_{3}} - \\frac{1}{2}\\left( {{MG} + M{k}^{\\prime }}\\right)  =  - \\frac{1}{2}{MT} \\tag{5 - 55}\n$$\n式中, ${MT} = {MG} + {M{k}^{\\prime }} - {{2M}{V}_{\\mathrm{{TH}}}}$ 为包含图形、工艺因子 ${k}^{\\prime }$ 和开启电压 ${V}_{\\mathrm{{TH}}}$ 的总失配参数因子,其中 $M{V}_{\\mathrm{{TH}}} = \\Delta {V}_{\\mathrm{{TH}}3,4}/{\\Delta }_{3}$ 。\n由于失配因子的随机变化, ${MT}$ 可正可负,考虑最差状态下的失配因子并对其取绝对值, $\\mathrm{{CMRRr}} = 4{g}_{\\mathrm{m}1}{R}_{\\mathrm{S}}/\\left| {M{T}_{\\max }}\\right|$ 。"
}