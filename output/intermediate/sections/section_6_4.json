{
  "section_num": "6.4",
  "title": "全差分输入级 14",
  "start_line": 4111,
  "end_line": 4212,
  "content": "### 6.4 全差分输入级\n差分输入、差分输出的全差分电路具有抗噪声能力强、共模抑制比高的突出优点。下面首先分析低增益和高增益的两种全差分增益结构,并对高增益全差分对中的共模负反馈 CMFB 电路设计进行分析。\n#### 6.4.1 全差分结构\n基本的全差分输入结构如图 6-11 所示,由于采用全差分输出,理想条件下电路的静态工作点完全匹配, 系统失调可忽略。若工艺造成的随机失调能够控制在很小的范围内, 则全差分结构总的输入失调很低,可以获得很高的共模抑制比和电源抑制比特性。在全差分级连信号的处理中,有利于消除信号中以共模分量表现出的噪声信号,适合高精度的信号处理。\n根据输出阻抗的差异,全差分输入级分为低阻低增益和高阻高增益两种结构类型。图 6-11(a) 的全差分结构采用 MOS 二极管低阻负载, 虽然差分增益较低, 但增益的可控性强, 输出信号的共模电平可由 MOS 二极管的钳位而稳定设置和控制, 无需高增益全差分结构所必备的 CMFB 共模反馈电路。\n该类型全差分电路的差模信号增益为 ${A}_{\\mathrm{{dm}}} =  - {g}_{\\mathrm{{ml}}}/{g}_{\\mathrm{m}3}$ ,若考虑共模信号的单端输出, 则共模信号增益 ${A}_{\\mathrm{{CM}}}$ 即为单端输出的共模增益,即\n$$\n{A}_{\\mathrm{{CM}}} =  - \\frac{{g}_{\\mathrm{m}1}}{1 + {g}_{\\mathrm{m}1}2{r}_{\\mathrm{{ds}}5}}\\frac{1}{{g}_{\\mathrm{m}3}} =  - \\frac{1}{1 + 1/\\left( {2{g}_{\\mathrm{m}1}{r}_{\\mathrm{{ds}}5}}\\right) }\\frac{1}{2{g}_{\\mathrm{m}3}{r}_{\\mathrm{{ds}}5}} \\approx   - \\alpha \\frac{1}{2{g}_{\\mathrm{m}3}{r}_{\\mathrm{{ds}}5}} \\tag{6-15}\n$$\n式中 $\\alpha  \\leq  1$ ,则系统工作点失配决定的共模抑制比 $\\mathrm{{CMRR}} = 2{g}_{\\mathrm{m}3}{r}_{\\mathrm{{ds5}}}/\\alpha  \\approx  {g}_{\\mathrm{m}3}\\left( {2{R}_{\\mathrm{S}}}\\right)$ ,即为负载跨导与两倍尾电流电阻决定的增益关系。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_156_313_1332_935_515_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_156_313_1332_935_515_0.jpg)\n图 6-11 差分输入一差分输出的全差分结构\n在图 6-11(b) 所示的恒流负载全差分结构中,差模与共模增益近似按相同的速率增加\n$$\n\\left. \\begin{array}{l} {A}_{\\mathrm{{dm}}} =  - {g}_{\\mathrm{{ml}}}\\left( {{r}_{\\mathrm{{dsl}}}//{r}_{\\mathrm{{ds}}3}}\\right) \\\\  {A}_{\\mathrm{{CM}}} \\approx   - \\frac{\\alpha }{2{r}_{\\mathrm{{ds}}5}}\\left( {{r}_{\\mathrm{{ds}}3}//{g}_{\\mathrm{{ml}}}{r}_{\\mathrm{{ds}}1}{r}_{\\mathrm{{ds}}5}}\\right)  \\end{array}\\right\\}   \\tag{6-16}\n$$\n因此, 无论负载如何, 低输出阻抗与高输出阻抗的全差分结构具有近似相同的 CMRR。考虑到高阻输出的全差分结构中共模输出阻抗提高的幅度更大,则其 CMRR 相对低阻输出的全差分结构略有减小,即\n$$\n\\mathrm{{CMRR}} = \\frac{2{g}_{\\mathrm{m}1}}{\\alpha }\\frac{{r}_{\\mathrm{{ds}}5}}{{r}_{\\mathrm{{ds}}3}//\\left( {{g}_{\\mathrm{m}1}{r}_{\\mathrm{{ds}}1}{r}_{\\mathrm{{ds}}5}}\\right) }\\left( {{r}_{\\mathrm{{ds}}1}//{r}_{\\mathrm{{ds}}3}}\\right)  \\approx  \\frac{{g}_{\\mathrm{m}1}{r}_{\\mathrm{{ds}}5}}{\\alpha } \\tag{6-17}\n$$\n对于高阻全差分输出电路,需要 CMFB 控制电路以确定输出支路的共模静态点,电路结构相对复杂; 低阻全差分输入电路虽然结构简单, CMRR 相对较高, 但差模增益过小, 应用受到局限。而采用恒流源与 MOS 二极管并联的负载差分结构,可兼顾以上两种负载各自的优点,同时克服两种电路结构各自的不足。\n对于图 6-12 所示的兼容结构,当从不同角度考查时得到不同的结论。如删除起钳位作用的 ${\\mathrm{M}}_{4}/{\\mathrm{M}}_{5}$ 管,则增益增加,因此消极的观点认为 $\\mathrm{{MOS}}$ 二极管的引入将导致增益的下降；另一方面,以 $\\mathrm{{MOS}}$ 二极管为基本负载,如没有 ${\\mathrm{M}}_{6}/{\\mathrm{M}}_{7}$ 管的分流,则 $\\mathrm{{MOS}}$ 二极管过大的静态电流导致增益下降,因此积极的观点认为 ${\\mathrm{M}}_{6}/{\\mathrm{M}}_{7}$ 恒流源的引入可使电路增益提高。 显然, 形成这两种观点的原因在于参照对象的不同。由于并联电阻中的低阻决定增益, 因此在差分对管或尾电流相同的条件下, ${\\mathrm{M}}_{6}/{\\mathrm{M}}_{7}$ 的分流使 MOS 二极管输出阻抗增加, 实际差分增益相对独立 MOS 二极管负载条件下的增益略有提高, 同时保持了该结构输出共模电压和增益可控的优点。设计中使 ${\\mathrm{M}}_{6}/$ ${\\mathrm{M}}_{7}$ 的偏置电流较大而 ${\\mathrm{M}}_{4}/{\\mathrm{M}}_{5}$ 的偏置电流较小,可以更有效地提高全差分增益。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_157_707_893_687_430_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_157_707_893_687_430_0.jpg)\n图 6-12 兼容负载的全差分结构\n#### 6.4.2 共模负反馈(CMFB)电路\n单端输出的运算放大电路在闭环负反馈下,由于输入的虚短性质,则输出支路的共模信号由差分输入端的共模信号所决定,即单端输出依靠 ${V}_{\\mathrm{{id}}}$ 的失调及输入分辨率进行控制。而全差分运放的输出各自反馈到输入则情况完全不同,首先,相互间没有可供参照的参考电平,其次,差分输出两支路的失配状态不同,因此调节每一个支路的共模点所需的 ${V}_{\\mathrm{{id}}}$ 失调不同,即不存在相同的 ${V}_{\\mathrm{{id}}}$ 失调能将两输出支路的共模电平设定在同一静态点。只有采用附加的共模负反馈(CMFB)电路才能实现对输出共模点的调节,因此, CMFB 为高增益全差分电路必不可少的控制电路。\n差分放大器是对差模输入信号进行感应并放大,而 CMFB 则是对输出共模信号进行检测,并利用其负反馈控制调节输出支路的静态电流。图 6-13(a)(b)分别为全差分 CMFB 控制结构, 在该全差分电路中, CMFB 的输出可以选择调节负载恒流源或尾电流源的栅电位。此外, 也可选择调节放大管的静态电流, 将输出共模点调节到合适的电平位置。与差分放大相对应, CMFB 本质上是一种共模信号负反馈放大器,通过对共模增益的抑制处理,实现共模点的稳定。\nCMFB 电路通常包括两个组成部分, 首先是共模信号感应检测与放大模块, 其次是控制信号的产生与控制模块。CMFB 可以有多种不同的实现方式, 图 6-13 中 (c) 给出了两种简单的 ${V}_{\\mathrm{{CM}}}$ 检测方式。一种是采用平衡电阻的检测,根据 ${V}_{\\mathrm{{CM}}} = \\left( {{V}_{\\mathrm{o}1} + {V}_{\\mathrm{o}2}}\\right) /2$ 的定义,采用叠加原理,电阻中点的输出电压为 ${V}_{\\mathrm{M}} = {V}_{\\mathrm{o}1} + \\left( {{V}_{\\mathrm{o}2} - {V}_{\\mathrm{o}1}}\\right) /2$ 或 ${V}_{\\mathrm{M}} = {V}_{\\mathrm{o}2} + \\left( {{V}_{\\mathrm{o}1} - {V}_{\\mathrm{o}2}}\\right) /2$ , 即 ${V}_{\\mathrm{M}} = {V}_{\\mathrm{{CM}}}$ 。这种共模信号的检测电路结构简单,而且在静态平衡条件下,电阻 $R$ 两端的共模信号相同,且电阻中没有电流,因此对静态偏置点没有影响。但以 $R$ 作为差分对的输出阻抗,其值较低,降低了差模增益的值。因此,为抑制电阻共模电压感应带来的不利影响, 需要采用大的共模检测电阻 $R$ 。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_158_184_623_1212_456_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_158_184_623_1212_456_0.jpg)\n图 6-13 全差分 CMFB 控制结构\n为了彻底克服电阻检测型 CMFB 电路的不足,可采用串联电容代替串联电阻。电容上没有静态电流,低频下的容抗很高,对运放低频下的差模增益影响小。当 ${V}_{\\mathrm{o}1} = {V}_{\\mathrm{o}2} = {V}_{\\mathrm{C}\\mathrm{M}}$ 时,电容 $C$ 两端没有压差,则 ${V}_{\\mathrm{M}} = {V}_{\\mathrm{{CM}}}$ ; 在差分输入电压下,当 ${V}_{\\mathrm{o}1}$ 和 ${V}_{\\mathrm{o}2}$ 以相反的极性变化时,若电容的充放电速度足够快,电容 $C$ 存储的电荷能够达到其与电压驱动的平衡值。则根据两电容 $C$ 上存储电荷的平衡条件,有 $C\\left( {{V}_{\\mathrm{o}1} - {V}_{\\mathrm{M}}}\\right)  = C\\left( {{V}_{\\mathrm{M}} - {V}_{\\mathrm{o}2}}\\right)$ ,即 ${V}_{\\mathrm{M}} = \\left( {{V}_{\\mathrm{o}1} + }\\right.$ $\\left. {V}_{\\mathrm{o}2}\\right) /2 = {V}_{\\mathrm{{CM}}}$ 。\n电容反馈型CMFB虽然解决了电阻反馈型CMFB存在的问题,但电容反馈型CMFB 带来的新问题是反馈控制电路的速度相对较慢。直观上看,输出电容的充放电延迟,一方面对差分增益的频率和动态响应速度产生不良影响; 另一方面, ${V}_{CM}$ 作为一种宽范围的大信号变化,其延迟相当于差模信号显著增加,造成 CMFB 的响应速度降低,限制了电容反馈 CMFB 控制的全差分电路在高速信号处理领域内的应用。\n采用开关电容 CMFB 可解决普通电容 CMFB 电路面临的各种问题, 并保留低功耗的优异性能。开关电容 CMFB 的一种基本结构如图 6-14(a) 所示,利用开关电容等效的开关电阻实现 CMFB 控制, 解决线性电阻带来的低频功耗与增益损失。开关电容型 CMFB 电路的另一种常用结构如图 6-14(b) 所示。一组共模电平用于对电容充电的参考电压,其中 ${V}_{\\mathrm{{cm}},\\mathrm{{ref}}}$ 是期望的共模电压, ${V}_{\\mathrm{{cmfb}}}$ 为 $\\mathrm{{CMFB}}$ 输出的实际偏置电压,用以调节恒流源并控制输出共模点。开关用于切换电容的充放电状态,实现 CMFB 控制功能。两个相同电容 ${C}_{2}$ 串接在差分输出 ${V}_{\\mathrm{{on}}}\\text{、}{V}_{\\mathrm{{op}}}$ 的两端,其中点的输出电位感应的是差分输出的共模信号,提供 ${V}_{\\mathrm{{cmfb}}}$ 的反馈电压信号。在以上电容两端通过开关控制,可分别并接上电荷传输电容 ${C}_{1}$ 。\n在开关电路依次相邻的两个工作周期内,第一个周期一组开关导通后对采样电容 ${C}_{1}$ 充电,第二个周期另一组互补的开关导通后将 ${C}_{1}$ 对电容 ${C}_{2}$ 放电。经过若干采样周期后,差分输出端的共模电平以及反馈输出分别被设置在所需的电平位置。CMFB 电路中的电容作为运放的负载,降低了电路处理的速度,因此 ${C}_{1}$ 和 ${C}_{2}$ 电容必须尽量减小。选择 ${C}_{1} \\gg  {C}_{2}$ 有利于降低各种误差,并使共模电压具备较快的建立时间；而选择 ${C}_{2} \\gg  {C}_{1}$ ,可使运放在不同的开关状态下有近似相同的电容负载。为抑制高频共模噪声, CMFB 的 GBW 应明显大于差分运放的 GBW。\n开关电容 CMFB 通常用于开关电容电路中全差分运算放大的设置。在时间连续的全差分运放电路中,一般需要时间连续的 CMFB 控制电路。为此,可采用基本的单级放大结构组成共模反馈电路。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_159_290_668_958_809_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_159_290_668_958_809_0.jpg)\n图 6-14 采用开关电容的 CMFB 电路\n图 6-15 给出了一种基于 CS 增益控制的 CMFB 电路。差分输出 $X\\text{、}Y$ 直接作为 ${\\mathrm{M}}_{13}/$ ${\\mathrm{M}}_{14}$ 对管的输入信号。对于 $X\\text{、}Y$ 的差模输入,对管中的总电流不变,即 $\\mathrm{A}$ 点电位不变,因此这种对管对差模信号不响应。相反,当输入为共模信号时,对管中的电流同时增加或减小, 导致 $\\mathrm{A}$ 点电位响应输入共模信号的变化。由于 ${\\mathrm{M}}_{13}/{\\mathrm{M}}_{14}$ 与差分对管的性质正好相反,可视为共模对管,响应共模信号的变化。当 $X\\text{、}Y$ 共模输出偏高时,共模对管中的电流增加,但由于 ${\\mathrm{M}}_{5}/{\\mathrm{M}}_{6}$ 恒源偏置作用,迫使 $\\mathrm{A}$ 点电压下降, $\\mathrm{A}$ 点电压的降低又使 ${\\mathrm{M}}_{11}/{\\mathrm{M}}_{12}\\mathrm{{CG}}$ 管中的电流增加,而 NMOS 恒流源电流的增加将使输出共模点降低。设置合适的器件参数,以上对共模信号的负反馈将使输出共模点稳定在所需的静态偏置下。\n图 6-16 中的 CMFB 控制从主输出支路中独立出来, 减小了它对输出电压动态范围损失的不利影响。同时,对共模信号的感应放大采用 NMOS 与 PMOS 上下互补对称的 CS-CG共模对结构,提高共模增益。当输出点 $X\\text{、}Y$ 输出的共模信号偏低时,互补共模对的输出 $\\mathrm{A}$ 点偏高,导致主差分对静态偏置电流降低,输出共模点升高,平衡下达到稳定的静态工作点。由于这种方式改变了差分对管等效静态电流, 使电路差分放大的性能发生改变, 在具体应用中应十分慎重。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_160_133_361_650_510_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_160_133_361_650_510_0.jpg)\n图 6-15 CS 控制的 CMFB 电路\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_160_815_372_598_502_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_160_815_372_598_502_0.jpg)\n图 6-16 互补 $\\mathrm{{CS}} - \\mathrm{{CG}}$ 控制的 $\\mathrm{{CMFB}}$ 电路\n图 6-17 给出了两种 CMFB 电路。一种是将电路输出信号直接加在 PMOS 负载管的栅极对电路输出共模电平进行控制；另一种是用一组差分对实现 CMFB 电路。图中, CMFB 电路中 PMOS 差分对的一端接所需控制的共模信号 ${V}_{\\mathrm{{CM}}}$ ,当差分对感应的实际输出共模电平高于 ${V}_{\\mathrm{{CM}}}$ 时,尾电流全部流入 $\\mathrm{{NMOS}}$ 二极管负载管,再经过 $\\mathrm{{NMOS}}\\mathrm{{CS}}$ 的放大,使反馈的控制电位降低,将差分输出的共模电压下拉,并稳定在 ${V}_{\\mathrm{{CM}}}$ 。而当输出为差模信号时,两感应 PMOS 管中的电流之和保持不变,共源端交流接地,并使 CMFB 输出支路电流相同；同样, NMOS 二极管负载中的电流之和保持为常数,等效为交流接地,维持 CMFB 输出支路电流平衡的状态。最终, CMFB 的输出不响应差模信号,实现共模信号的反馈控制。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_160_270_1357_1002_630_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_160_270_1357_1002_630_0.jpg)\n图 6-17 采用差分对结构的 CMFB 电路\n#### 6.4.3 高增益全差分运放电路\n完整的高增益全差分运放电路包括主增益运放结构及 CMFB 共模负反馈电路。图 6-18 和图 6-19 分别给出了一种 $\\mathrm{N}$ 型和 $\\mathrm{P}$ 型差分输入的折叠式 Cascode 全差分运放电路, CMFB 电路同时提供主运放尾电流及 Cascode 恒流源偏置。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_161_284_496_971_536_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_161_284_496_971_536_0.jpg)\n图 6-18 N型折叠式 Cascode 全差分电路\n以图 6-19 所示的电路为例, ${\\mathrm{M}}_{1}/{\\mathrm{M}}_{9}$ 的输入分别感应输出信号,其漏电极短路以感应共模电流而抑制差模电流, 即差模输出不改变以上对管的电流之和, 而共模信号则改变两管的电流之和。由于 ${V}_{\\mathrm{{bnl}}}$ 恒流偏置的作用, ${\\mathrm{M}}_{3}/{\\mathrm{M}}_{10}$ 两管中近似流过相同的电流。因此,对于输出差模信号, ${\\mathrm{M}}_{2}/{\\mathrm{M}}_{8}$ 对管中的电流和固定不变,从而确保 ${\\mathrm{M}}_{7}/{\\mathrm{M}}_{6}$ 中稳定的电流并提供主差分对的尾电流偏置。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_161_295_1336_963_541_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_161_295_1336_963_541_0.jpg)\n图 6-19 P 型折叠式 Cascode 全差分电路\n对于共模信号,当输出共模电平偏高时, ${\\mathrm{M}}_{1}/{\\mathrm{M}}_{9}$ 中的电流总和增加,则必然导致 ${\\mathrm{M}}_{2}/$ ${\\mathrm{M}}_{8}$ 中的电流总和减小。这实质上是一个负反馈作用,减小的电流使 PMOS 差分对的尾电流减小,进而使 NMOS CG 管的电流增加,而 PMOS Cascode 恒流特性稳定不变,从而将输出共模点向电平减小的方向推移,最终达到稳定的共模静态点。"
}