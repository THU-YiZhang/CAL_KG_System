{
  "section_num": "4.2",
  "title": "电压模带隙基准",
  "start_line": 2083,
  "end_line": 2384,
  "content": "### 4.2 电压模带隙基准\n#### 4.2.1 正负温度系数电流与电压\n产生 $\\mathrm{{BGR}}$ 所需要的正负温度系数电流和电压,利用相关偏置电路产生。其中 ${V}_{\\mathrm{{BE}}}$ 提供天然的高稳定负温度系数电压。由 ${V}_{\\mathrm{{BE}}}$ 电压可以方便地转换到 ${V}_{\\mathrm{{BE}}}/R$ 的负温度系数电流, 此电流在上一章中采用了基于电流镜的控制结构。同样, 这里采用基于运放虚短特性的控制原理,电路如图 4-1 所示。如忽略电阻的温度系数,得到的电流近似具有 ${\\mathrm{I}}_{\\mathrm{{PTAT}}}$ (Inverse Proportional To Absolute Temperature),即负温度特性。而 PTAT 量,则可由 $\\Delta {V}_{\\mathrm{{BE}}}$ 产生, 其中与电阻 $R$ 串联的 BJT 二极管应具有更大的发射区面积,通过电流镜控制可使两支路电流实现精度匹配的要求,电路结构如图 4-2 所示。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_78_347_1534_344_473_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_78_347_1534_344_473_0.jpg)\n图 4-1 负温度系数电流产生电路\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_78_878_1567_349_473_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_78_878_1567_349_473_0.jpg)\n图 4-2 正温度系数电流产生电路\n对于 $\\mathrm{{PTAT}}$ 偏置,电阻 $R$ 上产生的电压 $\\Delta {V}_{\\mathrm{{BE}}} = {V}_{\\mathrm{T}}\\ln \\left( N\\right) , N$ 为 ${\\mathrm{Q}}_{2}$ 与 ${\\mathrm{Q}}_{1}$ 发射区面积之比的常数。考虑电阻温度系数后, PTAT 电压转换成的 $\\Delta {V}_{\\mathrm{{BE}}}/R$ 支路电流偏离了理想的 PTAT 特性, 但再经同类型电阻转换回电压分量后, 电阻温度系数引起的温度变化相互抵消, 输出电压又返回到 PTAT 电压特性。通常, 为分析方便, 对电压电流转换过程中的电流, 通常忽略电阻温度系数的影响, 仍采用 PTAT 的电流近似。\n#### 4.2.2 线性补偿的残余温度系数\n实际 $\\mathrm{{PN}}$ 结导通电压的负温度系数并非理想的固定常数,这是线性温度补偿无法实现宽温区零温度系数电压基准的根源。 $\\mathrm{{PN}}$ 结导通电压的温度特性受到流过 $\\mathrm{{PN}}$ 结电流温度特性的调制,导通电压与电流表现为复杂的非线性函数关系。理解 ${V}_{\\mathrm{{BE}}}$ 的温度特性对 $\\mathrm{{BGR}}$ 高阶补偿的设计至关重要。\n$\\mathrm{{PN}}$ 结电流在充分导通的变化范围内,满足以下经典指数关系\n$$\n{I}_{\\mathrm{C}} = {I}_{\\mathrm{S}}\\left( T\\right) \\left\\lbrack  {\\exp \\left( \\frac{{V}_{\\mathrm{{BE}}}}{{V}_{\\mathrm{T}}}\\right)  - 1}\\right\\rbrack   \\approx  {I}_{\\mathrm{S}}\\left( T\\right) \\exp \\left( \\frac{{V}_{\\mathrm{{BE}}}\\left( T\\right) }{{V}_{\\mathrm{T}}}\\right)  \\tag{4 - 1}\n$$\n${I}_{\\mathrm{S}}$ 反向饱和电流与 $\\mathrm{{PN}}$ 结结面积成正比,同时强烈依赖于温度的变化。受载流子迁移率、扩散系数、本征载流子浓度、有效质量等参数温度特性的共同影响,饱和电流的温度特性近似为\n$$\n{I}_{\\mathrm{S}} = {C}_{0}{T}^{4 - n}\\exp \\left( {-\\frac{{V}_{\\mathrm{g}}}{{V}_{\\mathrm{T}}}}\\right)  \\tag{4 - 2}\n$$\n则由以上两式可得到\n$$\n{V}_{\\mathrm{{BE}}}\\left( T\\right)  = {V}_{\\mathrm{T}}\\ln \\left( \\frac{{I}_{\\mathrm{C}}}{{I}_{\\mathrm{S}}}\\right)  = {V}_{\\mathrm{g}} + {V}_{\\mathrm{T}0}\\frac{T}{{T}_{0}}\\left\\lbrack  {\\ln \\frac{{I}_{\\mathrm{C}}}{{C}_{0}} + \\left( {n - 4}\\right) \\ln T}\\right\\rbrack   \\tag{4 - 3}\n$$\n通常 $\\Delta {V}_{\\mathrm{{BE}}}$ 电压在电阻 $R$ 上产生正温度系数电流,该电流流过与此电阻串联的 $\\mathrm{{PN}}$ 结后, 支路电流温度特性可表示为以下一般关系, 即\n$$\n{I}_{\\mathrm{C}} = {k}_{\\mathrm{m}}\\frac{{V}_{\\mathrm{T}}}{R\\left( T\\right) } = {I}_{0}{\\left( \\frac{T}{{T}_{0}}\\right) }^{\\alpha } = {I}_{0}{\\left( 1 + \\frac{T - {T}_{0}}{{T}_{0}}\\right) }^{\\alpha } \\tag{4 - 4}\n$$\n当 $\\alpha  = 0$ 时, ${I}_{\\mathrm{C}}$ 为理想的温度无关 (Temperature Independent) 电流, $\\alpha  = 1$ 为 PTAT 正温度系数电流。显然, $\\mathrm{{PN}}$ 结电流的温度特性强烈依赖于电阻的温度系数。假设电阻具有一阶正温度或负温度系数 ${T}_{\\mathrm{{CR}}}$ ,在 $T$ 接近 ${T}_{0}$ 条件下,电阻温度特性为\n$$\nR\\left( T\\right)  = {R}_{0}\\left\\lbrack  {1 + {T}_{\\mathrm{{CR}}}\\left( {T - {T}_{0}}\\right) }\\right\\rbrack   = {R}_{0}\\left\\lbrack  {1 + {\\alpha }_{\\mathrm{R}}\\frac{T - {T}_{0}}{{T}_{0}}}\\right\\rbrack\n$$\n$$\n\\approx  {R}_{0}{\\left\\lbrack  1 + \\frac{T - {T}_{0}}{{T}_{0}}\\right\\rbrack  }^{{a}_{R}} = {R}_{0}{\\left( \\frac{T}{{T}_{0}}\\right) }^{{a}_{R}} \\tag{4 - 5}\n$$\n将以上具有线性温度系数的电阻代入式 (4-4) 后, 得到与电阻相关的支路电流温度特性为\n$$\n{I}_{\\mathrm{C}} = {k}_{\\mathrm{m}}\\frac{{V}_{\\mathrm{T}0}}{R\\left( {T}_{0}\\right) }\\left( \\frac{T}{{T}_{0}}\\right) \\frac{R\\left( {T}_{0}\\right) }{R\\left( T\\right) } = {k}_{\\mathrm{m}}\\frac{{V}_{\\mathrm{T}0}}{R\\left( {T}_{0}\\right) }{\\left( \\frac{T}{{T}_{0}}\\right) }^{1 - {\\alpha }_{\\mathrm{R}}} = {I}_{\\mathrm{C}0}{\\left( \\frac{T}{{T}_{0}}\\right) }^{\\alpha } \\tag{4 - 6}\n$$\n式中: ${\\alpha }_{\\mathrm{R}} = {T}_{\\mathrm{{CR}}} \\times  {T}_{0}$ 为 $\\mathrm{{PN}}$ 结电流偏离 $\\mathrm{{PTAT}}$ 特性的指数系数, $\\alpha  = 1 - {\\alpha }_{\\mathrm{R}}$ 。\n以 CSMC ${0.6\\mu }\\mathrm{m}$ CMOS 工艺为例,与电阻温度系数 ${T}_{\\mathrm{{CR}}}$ 相关联的系数 $\\alpha$ 如表 4-1 所示。\n表 4-1 电阻温度系数及 $\\alpha$ 值\n<table><tr><td>序 号</td><td>电阻类型</td><td>${T}_{\\mathrm{C}}\\left( {\\times {10}^{-6}/{}^{ \\circ  }\\mathrm{C}}\\right)$</td><td>${\\alpha }_{\\mathrm{R}}$</td><td>$\\alpha$</td></tr><tr><td>1</td><td>Poly1</td><td>-1200</td><td>-0.36</td><td>1.36</td></tr><tr><td>2</td><td>Poly2</td><td>-280</td><td>-0.084</td><td>1.084</td></tr><tr><td>3</td><td>P 阱</td><td>$+ {1350}$</td><td>0.405</td><td>0.595</td></tr><tr><td>4</td><td>$\\mathrm{N}$ 阱</td><td>$+ {2000}$</td><td>0.6</td><td>0.4</td></tr></table>\n显然由于电阻温度系数的影响, $\\alpha  \\neq  1$ ,即流过 $\\mathrm{{PN}}$ 结的电流并不是理想的 PTAT 电流。只有在电阻温度系数很小的条件下, ${I}_{\\mathrm{C}}$ 电流才具有近似 $\\mathrm{{PTAT}}$ 特性。但该电流流过另一个同类型电阻后,电阻温度系数可以相互补偿并抵消,该非理想 PTAT 电流在输出电阻上转换成理想的 PTAT 电压。该 PTAT 电压决定了 BGR 一阶线性补偿的精度。若温度系数 $\\gamma  = 4 - n$ ,利用(4 - 6)和(4 - 2)两式关系,可以得到\n$$\n\\frac{{I}_{\\mathrm{C}}}{{I}_{\\mathrm{S}}} = {C}_{1}{T}^{\\alpha  + n - 4}\\exp \\left( \\frac{{V}_{\\mathrm{g}}}{{V}_{\\mathrm{T}}}\\right)  = {C}_{1}{T}^{\\alpha  - \\gamma }\\exp \\left( \\frac{{V}_{\\mathrm{g}}}{{V}_{\\mathrm{T}}}\\right)  \\tag{4 - 7}\n$$\n与电流温度特性相关的 $\\mathrm{{PN}}$ 结导通电压为 ${V}_{\\mathrm{{BE}}}\\left( T\\right)  = {V}_{\\mathrm{T}}\\ln \\left( {{I}_{\\mathrm{C}}/{I}_{\\mathrm{S}}}\\right)$ ,导通电压的温度特性为\n$$\n{V}_{\\mathrm{{BE}}}\\left( T\\right)  = {V}_{\\mathrm{g}} + {V}_{\\mathrm{T}}\\left\\lbrack  {\\ln {C}_{1} + \\left( {\\alpha  - \\gamma }\\right) \\ln T}\\right\\rbrack   = {V}_{\\mathrm{g}} - {V}_{\\mathrm{T}}\\left\\lbrack  {\\left( {\\gamma  - \\alpha }\\right) \\ln \\left( \\frac{T}{{T}_{0}}\\right)  - \\ln {C}_{1}{T}_{0}^{\\gamma  - \\alpha }}\\right\\rbrack\n$$\n$$\n= {V}_{\\mathrm{g}} - {V}_{\\mathrm{T}}\\left( {\\gamma  - \\alpha }\\right) \\ln \\frac{T}{{T}_{0}} + \\frac{T}{{T}_{0}}{V}_{\\mathrm{T}0}\\ln {C}_{2} \\tag{4 - 8}\n$$\n式中: ${C}_{1}\\text{、}{C}_{2}$ 均为常数; $\\gamma$ 为温度系数。\n由 $T = {T}_{0}$ 时 ${V}_{\\mathrm{{BE}}}\\left( T\\right)  = {V}_{\\mathrm{{BE}}}\\left( {T}_{0}\\right)  = {V}_{\\mathrm{{BE}}0}$ ,求出 ${V}_{\\mathrm{{BE}}}\\left( {T}_{0}\\right)  = {V}_{\\mathrm{g}0} + {V}_{\\mathrm{T}0}{ln}{C}_{2}$ ,由此得到\n$$\n{V}_{\\mathrm{{BE}}}\\left( T\\right)  = {V}_{\\mathrm{g}} - \\left( {{V}_{\\mathrm{g}0} - {V}_{\\mathrm{{BE}}0}}\\right) \\frac{T}{{T}_{0}} - \\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}}\\ln \\left( \\frac{T}{{T}_{0}}\\right)  \\tag{4 - 9}\n$$\n因此,基于 ${V}_{\\text{ref }} = {V}_{\\mathrm{{BE}}} + {V}_{\\mathrm{{PTAT}}} = {V}_{\\mathrm{{BE}}} + {k}_{\\mathrm{m}}{V}_{\\mathrm{T}}$ 传统电压求和的线性补偿模式,其基准输出为\n$$\n{V}_{\\mathrm{{ref}}}\\left( T\\right)  = {V}_{\\mathrm{g}} + {k}_{\\mathrm{m}}{V}_{\\mathrm{T}} - \\left( {{V}_{\\mathrm{g}0} - {V}_{\\mathrm{{BE}}0}}\\right) \\frac{T}{{T}_{0}} - \\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}}\\ln \\left( \\frac{T}{{T}_{0}}\\right)  \\tag{4 - 10}\n$$\n采用常规的分析方法,定义在 $T = {T}_{0}$ 温度上基准的温度系数为零,若忽略硅带隙宽度 ${V}_{\\mathrm{g}}$ 的温度特性,可得\n$$\n{\\left. \\frac{\\mathrm{d}{V}_{\\mathrm{{ref}}}\\left( T\\right) }{\\mathrm{d}T}\\right| }_{\\mathrm{T} = \\mathrm{T}0} = {k}_{\\mathrm{m}}\\frac{{V}_{\\mathrm{T}0}}{{T}_{0}} - \\frac{{V}_{\\mathrm{g}0} - {V}_{\\mathrm{{BE}}0}}{{T}_{0}} - \\left( {\\gamma  - \\alpha }\\right) \\frac{k}{q}\\ln \\left( \\frac{{T}_{0}}{{T}_{0}}\\right)  - \\left( {\\gamma  - \\alpha }\\right) \\frac{{V}_{\\mathrm{T}0}}{{T}_{0}} = 0\n$$\n(4 - 11)\n由(4-11)求出的一阶 ${V}_{\\mathrm{{PTAT}}}$ 电压补偿量为\n$$\n{k}_{\\mathrm{m}}{V}_{\\mathrm{T}} = {k}_{\\mathrm{m}}{V}_{\\mathrm{T}0}\\frac{T}{{T}_{0}} = \\left( {{V}_{\\mathrm{g}0} - {V}_{\\mathrm{{BE}}0}}\\right) \\frac{T}{{T}_{0}} + \\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}} = \\left\\lbrack  {\\frac{{V}_{\\mathrm{g}0} - {V}_{\\mathrm{{BE}}0}}{{V}_{\\mathrm{T}0}} + \\left( {\\gamma  - \\alpha }\\right) }\\right\\rbrack  {V}_{\\mathrm{T}}\n$$\n(4 - 12)\n${V}_{\\mathrm{{PTAT}}}$ 正温度系数电压只能补偿式 (4-10) 中的线性负温度电压项。同时,由于高阶温度电压量的存在,为使一阶补偿在室温下的温度系数最小,与不考虑高阶温度特性的一阶补偿相比,实际的一阶补偿附加了额外的线性温度补偿项,即式 (4-12) 中的 $\\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}}$ 项。将上式代入式 (4-10) 后, 得到的输出基准为\n$$\n{V}_{\\text{ref }}\\left( T\\right)  = {V}_{\\mathrm{g}} + \\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}}\\left\\lbrack  {1 - \\ln \\left( {T/{T}_{0}}\\right) }\\right\\rbrack   \\tag{4 - 13}\n$$\n经过一阶线性温度补偿后的基准,其残余的高阶温度系数主要由式 (4-13) 中的 $\\ln (T/$ ${T}_{0}$ )非线性项引起。常温下基准 ${V}_{\\mathrm{{ref}}0} = {V}_{\\mathrm{g}0} + \\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}0}$ ,约为 ${1.23}\\mathrm{\\;V}$ 。彻底补偿高阶温度系数电压量的最根本方法是设置 $\\gamma  = \\alpha$ 。根据推导得到的参数关系, $\\gamma  = 4 - n, n$ 为 BJT 管注入载流子迁移率 $\\left( \\mu \\right)$ 温度关系中的指数因子,即 $\\mu  = {\\mu }_{0}{\\left( T/{T}_{0}\\right) }^{-n}, n$ 值强烈地依赖于 BJT 载流子扩散区的掺杂浓度。在较重的衬底掺杂下 $n$ 值变小,通常 $n = 1 \\sim  2$ ,则 $\\gamma  \\approx  2 \\sim  3$ 。 因此,零温度系数电压补偿需要提供 ${\\mathrm{{PTAT}}}^{2} \\sim  {\\mathrm{{PTAT}}}^{3}$ 的高阶 $\\mathrm{{PTAT}}$ 正温度系数电流。与限流支路中电阻温度特性有关的因子 $\\alpha  = 1 - {\\alpha }_{\\mathrm{R}} = 1 - {T}_{\\mathrm{{CR}}} \\times  {T}_{0}$ ,其中 ${T}_{\\mathrm{{CR}}}$ 为电阻的一阶温度系数,只有 ${T}_{\\mathrm{{CR}}} < 0$ 的负温度系数且数值很大时,才能有效提高 $\\alpha$ 的数值。 ${T}_{0} = {300}\\mathrm{\\;K}$ 的温度下,在表 4-1 所示实际电阻线性温度系数的范围内, $\\alpha$ 最大值在 1 附近,无法直接实现零温度系数补偿的要求。\n对非线性函数在平衡点附近泰勒展开,可考察各阶次非线性温度的大小,从中寻找高阶温度补偿的方法。设 $f\\left( T\\right)  = {V}_{\\text{ref }}\\left( T\\right)  - {V}_{\\mathrm{g}}$ 为基准中的非线性残存量,其一阶和两阶温度系数分别为\n$$\n{f}^{\\prime }\\left( T\\right)  = \\left( {\\gamma  - \\alpha }\\right) \\frac{k}{q}\\left\\lbrack  {1 - \\ln \\frac{T}{{T}_{0}}}\\right\\rbrack   + \\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}}\\left( {-\\frac{1}{T}}\\right)  =  - \\left( {\\gamma  - \\alpha }\\right) \\frac{{V}_{\\mathrm{T}}}{T}\\ln \\frac{T}{{T}_{0}} \\tag{4 - 14}\n$$\n式中 $k$ 为波尔兹曼常数。\n$$\n{f}^{\\prime \\prime }\\left( T\\right)  =  - \\left( {\\gamma  - \\alpha }\\right) \\frac{{V}_{\\mathrm{T}}}{{T}^{2}} \\tag{4 - 15}\n$$\n如仅考虑最高的两阶非线性温度效应,并由于 ${f}^{\\prime }\\left( {T}_{0}\\right)  = 0$ ,得到 $f\\left( T\\right)$ 在 ${T}_{0}$ 静态点的近似\n$$\nf\\left( T\\right)  = f\\left( {T}_{0}\\right)  + {f}^{\\prime }\\left( {T}_{0}\\right) \\left( {T - {T}_{0}}\\right)  + \\frac{1}{2!}{f}^{\\prime \\prime }\\left( {T}_{0}\\right) {\\left( T - {T}_{0}\\right) }^{2}\n$$\n$$\n= f\\left( {T}_{0}\\right)  - \\frac{1}{2}\\left( {\\gamma  - \\alpha }\\right) \\frac{{V}_{\\mathrm{T}0}}{{T}_{0}^{2}}{\\left( T - {T}_{0}\\right) }^{2} \\tag{4 - 16}\n$$\n代入 $f\\left( {T}_{0}\\right)$ 关系式,则一阶线性补偿后的基准仍然包含一阶以上的温度量,近似有\n$$\n{V}_{\\text{ref }}\\left( T\\right)  = {V}_{\\mathrm{g}} + \\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}0} - \\frac{1}{2}\\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}0}{\\left( \\frac{T}{{T}_{0}} - 1\\right) }^{2}\n$$\n$$\n= {V}_{\\mathrm{g}} + \\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}0}\\left( {\\frac{1}{2} + \\frac{T}{{T}_{0}} - \\frac{1}{2}\\frac{{T}^{2}}{{T}_{0}^{2}}}\\right)  \\tag{4-17}\n$$\n$\\gamma  \\neq  \\alpha$ 的状态决定了电压基准高阶温度系数的性质和大小。式 (4-17) 中忽略了三阶以上的温度项,因此只适合于基准温度特性曲线形状的定性判断。当温度在 ${T}_{0}$ 附近宽范围变化时,由于 $\\gamma  - \\alpha  > 0$ ,当 $T \\ll  {T}_{0}$ 时, ${V}_{\\text{ref }}\\left( T\\right)$ 随 $T$ 上升而增加; 当 $T \\gg  {T}_{0}$ 时, ${V}_{\\text{ref }}\\left( T\\right)$ 随 $T$ 上升而下降,即 ${V}_{\\text{ref }}\\left( T\\right)$ 温度特性曲线开口向下。\n实际上,以上基准补偿设计存在明显的缺陷,首先是将一阶补偿和二次以上的高阶补偿割裂开来,没有考虑两者之间的相互作用,其根源是采用的一阶和和二阶导数分析方法只适合于 ${T}_{0}$ 附近很窄的温区范围,因此对 $- {55}^{ \\circ  }\\mathrm{C} \\sim   + {125}^{ \\circ  }\\mathrm{C}$ 的宽温区范围内的分析结果便带来较大的误差。为了适应宽温区范围内的温度补偿,对于一阶线性补偿,应使基准的温度系数在整个温区范围内最小,而非在 ${T}_{0}$ 点最小；对于高阶补偿,一阶线性项与二阶高次项应相互配合,并非在一次线性补偿的基础上使 ${T}_{0}$ 点基准的温度系数最小,再考虑二次补偿,而应根据二次补偿的策略,适当改变线性补偿的系数,使基准输出在整个宽温区范围内具有最小的温度系数。\n以上补偿分析中均忽略了 ${V}_{\\mathrm{g}}\\left( T\\right)$ 的温度特定。实际上, ${V}_{\\mathrm{g}}\\left( T\\right)$ 具有近似固定的负温度系数,其数值随温度增加略有下降, ${V}_{\\mathrm{g}}\\left( {0\\mathrm{\\;K}}\\right)  = {1.170}\\mathrm{\\;V}$ 。因此,考虑 ${V}_{\\mathrm{g}}\\left( T\\right)$ 的温度特性后可适当调整线性补偿策略。这样,在宽温区范围内,经过最优温度补偿后的 ${V}_{\\text{ref }}\\left( T\\right)$ 可以出现非单调温度特性, 可出现开口向上或开口向下, 以及同时出现开口向下和开口向下等多种变化规律。一阶线性补偿或高阶补偿后,可将整个温区范围内基准最大值与最小值之间的差值降到最小,从而获得最小的温度系数。需要强调的是,对于高阶补偿,由于对非线性电压量的检测和控制精度要求很高,高阶补偿相对线性补偿的难度大幅度提高。另一方面,由于高阶补偿中的线性与非线性补偿是相互配合达到最优,当非线性补偿失效后,与之对应的线性补偿并非最优线性补偿,此时高阶补偿的效果反而变差。因此,只有在达到对非线性温度量精确可控的前提下, 才应考虑高阶补偿, 通常情况下一般只需考虑对一阶补偿的优化设计。\n#### 4.2.3 电压模带隙基准结构\n利用运放虚短特性控制电流匹配和支路电流定义, 可以得到如图 4-3 所示的带隙基准原型结构。图中(a)与(b)不同之处在于对运放负载驱动能力的要求不用,(a)中运放的输出为低阻,需要较大的负载电流驱动能力,直流阻性负载的影响导致运放低频增益下降,使虚短的控制精度下降；而(b)中运放的输出为 PMOS 管的栅电容,无负载电流驱动的需求。因此,实际的基准多采用(b)类型的系统结构。除此以外,两种电路结构中 $\\mathrm{{PN}}$ 结的构成方式也不同。\n图 4-3(a) 采用集电极电位自由的NPN管,形成的PN结电特性良好,即 ${I}_{\\mathrm{B}} \\ll  {I}_{\\mathrm{C}}$ (电流增益高)、基极寄生阻抗低、匹配精度高等,但需要 BiCMOS 工艺或高性能横向 BJT 结构的支持。图 4-3(b) 则采用集电极电位固定低电位的衬底寄生 PNP 管,由 N 阱 CMOS 工艺提供,形成的 PN 结电性能和匹配特性较差。忽略电路中各种非理想因子的影响,输出的基准电压为\n$$\n{V}_{\\text{ref }} = {V}_{\\mathrm{{BE}}2} + \\frac{\\Delta {V}_{\\mathrm{{BE}}}}{{R}_{1}}{R}_{2} = {V}_{\\mathrm{{BE}}2} + {V}_{\\mathrm{T}}\\frac{{R}_{2}}{{R}_{1}}\\ln \\left( \\frac{{S}_{\\mathrm{e}1}}{{S}_{\\mathrm{e}2}}\\right)  \\tag{4 - 18}\n$$\n注意图中运放正负极性在电路中的连接方式。在静态条件下, 运放正负极性相位的连接方式似乎无关紧要。但在动态过程中,运放极性连接至关重要。运放某一端的输入信号经过闭环反馈回到原始位置时,可形成两种不同性质的反馈。对于以上结构,由于运放两输入端的极性相反,而除去运放以外的反馈环路极性相同,因此系统中必然同时存在正负两种性质的反馈。根据系统稳定的控制原理,稳态下要求正反馈弱、负反馈强,系统总体表现为负反馈。在此控制要求下,运放输入端在电路中的位置关系被唯一确定。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_83_350_658_878_459_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_83_350_658_878_459_0.jpg)\n图 4-3 基于 OP 虚短特性的一阶线性补偿电压模式 BGR\n由于 $\\mathrm{{PN}}$ 结的电压钳位作用,其反馈比 $\\mathrm{{PN}}$ 结串联电阻结构的反馈更弱。实际上,在相同的静态电流条件下,两二极管的交流小信号电阻相同,因此二极管上有电阻串联的支路在运放输入端到 GND 的输入阻抗高,信号反馈强,可用于构成系统的闭环负反馈。根据以上原则, PN 结钳位点所连运放的输入端必需对应于该环路的正反馈,而有电阻串联的 PN 结所接运放的输入端应构成环路的负反馈。\n基于以上原则,图 4-3(a) 中运放的同相端需接 ${\\mathrm{Q}}_{1}$ 管的钳位端,电阻 ${R}_{3}$ 上端接运放反向端。图 4-3(b) 中, 因环路中增加了一级倒相放大, 运放输入端环路反馈极性与图 4-3(a) 正好相反,运放的反相输入端为环路的正反馈,必需接 ${\\mathrm{Q}}_{2}$ 管的 $\\mathrm{{PN}}$ 结钳位位置。若运放输入极性的连接位置相反,电路将无法达到或维持在稳定的静态工作点,系统失效。\n#### 4.2.4 误差分析\n式 (4-18) 给出的是理想状态下电压基准的输出, 所谓理想状态是指: 电流镜完全匹配、 运放增益无穷且无失调,晶体管具有理想的指数电流特性且完全匹配,电阻完全匹配其温度系数可相互抵消。然而, 实际电路中非理想因素的作用使以上理想条件无法满足, 由此造成输出电压值和温度系数产生较大的漂移。\n## 1)运放失调 ${V}_{\\text{OS }}$\n在众多非理想因子中, 运放输入失调对基准的影响最为显著, 考虑失调后的基准电压为\n$$\n{V}_{\\mathrm{{ref}}} = {V}_{\\mathrm{{BE}}2} + \\frac{\\Delta {V}_{\\mathrm{{BE}}} + {V}_{\\mathrm{{OS}}}}{{R}_{1}}{R}_{2} = {V}_{\\mathrm{{ref}}0} + \\frac{{R}_{2}}{{R}_{1}}{V}_{\\mathrm{{OS}}} \\tag{4 - 19}\n$$\n式中 ${V}_{\\text{ref }}$ 为理想条件下的基准输出,输入失调 ${V}_{\\text{OS }}$ 与运放增益、工作状态点匹配等因素相关,正常情况下 (对称设计) ${V}_{\\mathrm{{OS}}}$ 在几十毫伏以内。在面积比 $N < {10}$ 的状态下,调节正温度系数的电阻比约为 ${R}_{2}/{R}_{1} \\approx  {10}$ ,因此运放输入失调被放大一个量级后成为基准的失调而输出,误差可高达几百毫伏的量级。因此,增加面积比 $N$ 或通过等效方式增加此 $N$ 值,可适当降低电阻比,从而抑制运放输入失调的放大输出。\n## 2)线性比例失配\n线性比例失配包含电流镜、面积比 $N$ 值、电阻比失配三个方面。比例失配同样对基准的精度和温度特性产生影响。在图 4-3(b) 结构中,由于 ${\\mathrm{M}}_{3}\\text{、}{\\mathrm{M}}_{4}$ 两管的 ${V}_{\\mathrm{{DS}}}$ 电压不同,造成两支路电流的失配。为此,在 ${\\mathrm{M}}_{4}$ 管的漏端串联与 ${\\mathrm{M}}_{3}$ 漏端相同的电阻 ${R}_{2}$ ,设置两管 ${V}_{\\mathrm{{DS}}}$ 相同以提高电流匹配精度,电路如图4-4(a)所示。电流的匹配特性主要由 MOS 管及电阻的匹配性共同决定,但 MOS 管的匹配起主导作用,电阻的匹配起辅助作用。为此,考虑到静态条件下 ${\\mathrm{M}}_{3}$ 、 ${\\mathrm{M}}_{4}$ 两管的工作点状态完全相同,因此可以合并成一个 PMOS 管,电路如图 $4 - 4\\left( \\mathrm{\\;b}\\right)$ ,此时电路支路电流主要由相同类型 ${R}_{1}\\text{、}{R}_{2}$ 电阻的匹配精度决定。由于电阻绝对阻值工艺漂移对输出基准电压值的影响, 通常需要对输出支路电阻进行激光或烧铝微调, 此时可将 ${R}_{1}$ 和 ${R}_{2}$ 分别减去同样大小的阻值,减去的电阻合并后阻值减一半,其中一端接 PMOS漏,另一端接调整后的 ${R}_{1}$ 、 ${R}_{2}$ 电阻的公共端,对该电阻的微调即可实现对输出基准电压值的改变。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_84_365_1085_811_515_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_84_365_1085_811_515_0.jpg)\n图 4-4 对工作点失配的改进\n因此, 线性比例因子的电路设计首先应通过参数和静态工作点的匹配, 消除系统失调的影响, 如果工艺理想, 工艺加工造成的随机失调可降到最低。然而, 实际工艺均存在一定的加工匹配精度,必须了解电阻、 $W/L$ 、 ${V}_{\\mathrm{{TH}}}$ 、 $\\beta (W/L$ 宽长比、 ${V}_{\\mathrm{{TH}}}$ 阈顶电压、 $\\beta$ 三极管电流增益) 等关键参数在工艺随机失配状态下对输出基准的影响。首先考虑电流镜失配, 设 PTAT 偏置电路两支路电流失配为 ${\\varepsilon }_{\\mathrm{{CMI}}}$ ,而输出支路电流镜失配为 ${\\varepsilon }_{\\mathrm{{CM2}}}$ ,由此引起的基准变化为\n$$\n\\Delta {V}_{\\text{ref_CM }} = \\left( {1 + {\\varepsilon }_{\\mathrm{{CM}}2}}\\right) \\frac{{R}_{2}}{{R}_{1}}{V}_{\\mathrm{T}}\\ln \\left\\lbrack  {N\\left( {1 + {\\varepsilon }_{\\mathrm{{CM}}1}}\\right) }\\right\\rbrack   - \\frac{{R}_{2}}{{R}_{1}}{V}_{\\mathrm{T}}\\ln \\left( N\\right)  \\tag{4 - 20}\n$$\n假设各电流镜具有近似相同的失配 ${\\varepsilon }_{\\mathrm{{CM}}}$ ,由此引入的失调为\n$$\n\\Delta {V}_{\\text{ref },\\mathrm{{CM}}} = \\frac{{R}_{2}}{{R}_{1}}{V}_{\\mathrm{T}}\\left\\{  {{\\varepsilon }_{\\mathrm{{CM}}2}\\ln \\left\\lbrack  {N\\left( {1 + {\\varepsilon }_{\\mathrm{{CMI}}}}\\right) }\\right\\rbrack   + \\ln \\left( {1 + {\\varepsilon }_{\\mathrm{{CMI}}}}\\right) }\\right\\}   \\approx  {\\varepsilon }_{\\mathrm{{CM}}}{V}_{\\mathrm{T}}\\frac{{R}_{2}}{{R}_{1}}\\left( {1 + \\ln N}\\right)\n$$\n(4 - 21)\n由于 $\\ln N > 1$ ,输出电流镜 ${\\varepsilon }_{\\mathrm{{CM}}2}$ 的影响比 $\\mathrm{{PTAT}}$ 电流镜失配 ${\\varepsilon }_{\\mathrm{{CM}}1}$ 的影响略大。同样,二极管发射区面积比 $N$ 值失配引起的误差为\n$$\n\\Delta {V}_{\\text{ref }\\_ \\mathrm{N}} = \\frac{{R}_{2}}{{R}_{1}}{V}_{\\mathrm{T}}\\ln \\left( {1 + {\\varepsilon }_{\\mathrm{N}}}\\right)  \\approx  {\\varepsilon }_{\\mathrm{N}}{V}_{\\mathrm{T}}\\frac{{R}_{2}}{{R}_{1}} \\tag{4 - 22}\n$$\n电阻比失配引起的误差为\n$$\n\\Delta {V}_{\\text{ref }\\_ \\mathrm{R}} = \\frac{{R}_{2}}{{R}_{1}}\\left( {1 + {\\varepsilon }_{\\mathrm{R}}}\\right) {V}_{\\mathrm{T}}\\ln N - \\frac{{R}_{2}}{{R}_{1}}{V}_{\\mathrm{T}}\\ln N = {\\varepsilon }_{\\mathrm{R}}{V}_{\\mathrm{T}}\\frac{{R}_{2}}{{R}_{1}}\\ln N \\tag{4 - 23}\n$$\n设各比例因子的失配误差相同并均为 ${\\varepsilon }_{\\mathrm{S}}$ ,则比例失配引起的基准总误差为\n$$\n\\Delta {V}_{\\mathrm{{ref}}\\_ \\mathrm{S}} = \\left( {{\\varepsilon }_{\\mathrm{{CM}}} + {\\varepsilon }_{\\mathrm{N}}}\\right) \\frac{{R}_{2}}{{R}_{1}}{V}_{\\mathrm{T}} + \\left( {{\\varepsilon }_{\\mathrm{{CM}}} + {\\varepsilon }_{\\mathrm{R}}}\\right) \\frac{{R}_{2}}{{R}_{1}}{V}_{\\mathrm{T}}\\ln N \\approx  2{\\varepsilon }_{\\mathrm{S}}\\frac{{R}_{2}}{{R}_{1}}{V}_{\\mathrm{T}}\\left( {1 + \\ln N}\\right) \\left( {4 - {24}}\\right)  \\tag{4 - 24}\n$$\n若将 ${\\varepsilon }_{\\mathrm{S}}$ 控制在 $1\\%$ 以内,基准偏差约为 ${0.6}{V}_{\\mathrm{T}} = {16}\\mathrm{{mV}}$ ,一般低于运放失调对基准输出的影响。此外, BJT 二极管的基极电阻失配也会引入一定的误差,适当提高电流增益 $\\beta$ ,增加电阻 ${R}_{1}$ 和 ${R}_{2}$ 的绝对值,降低基极电阻相对于 ${R}_{1}$ 或 ${R}_{2}$ 的变化量,都能有效抑制 $\\mathrm{{BJT}}$ 电阻失配带来的误差。\n#### 4.2.5 高阶曲率补偿\n对基本 BGR 改进的一个重要方面体现在基准温度系数的进一步降低。理论分析表明, 经过一阶线性温度补偿后,输出基准还残存较大的非线性温度变化量。无论其极性如何,都无法通过线性的 ${V}_{\\mathrm{{PTAT}}}$ 进行完全补偿。当残余的非线性项在某个工作温度范围内均为正温度系数时, 说明一阶 PTAT 补偿过大, 相反则补偿过小, 其温度特性在局部温区内呈单调性。一阶补偿在全温区内会出现非单调的温度特性。从数学的观点看, 对非线性温度项只有采用与此相关联的非线性量才能进行完全的补偿, 因此用于补偿的非线性电压量可以由原始非线性项变化得到, 也可由分段线性函数拟合得到。不同的二阶补偿方法, 必须与一阶补偿相结合, 才能得到最佳的补偿效果。\n## 1)分段补偿\n根据分段非线性电流生成机理的一种补偿电路结构和电流随温度变化曲线如图 4-5 (a) 和 $4 - 5$ (b) 所示。 ${\\mathrm{M}}_{2}$ 管电流镜按比例获得 ${I}_{{\\mathrm{V}}_{\\mathrm{{BE}}}} = {V}_{\\mathrm{{BE}}}/R$ 的负温度系数电流,从该电流中减去 ${k}_{1}{I}_{\\mathrm{{PTAT}}}$ 正温度系数电流后, ${\\mathrm{M}}_{3}$ 中得到了用于电压补偿的非线性温度电流 ${I}_{\\mathrm{{NL}}}$ ,电流镜 ${\\mathrm{M}}_{4}$ 的比例关系用于调节非线性比例系数,最终用于高阶非线性温度补偿。由于 ${I}_{\\mathrm{{PTAT}}}$ 电流在低温区范围远小于 ${I}_{{\\mathrm{V}}_{\\mathrm{{BE}}}}$ ,迫使 ${\\mathrm{M}}_{2}$ 进入线性区,从而导致 ${\\mathrm{M}}_{3}$ 截止,无电流输出。因此, 非线性温度补偿电流只有在中高温区才有输出, 即\n$$\n{I}_{\\mathrm{{NL}}} = \\left\\{  \\begin{array}{ll} 0 & {I}_{\\mathrm{{PTAT}}} \\leq  {I}_{{\\mathrm{V}}_{\\mathrm{{BE}}}} \\\\  {k}_{1}{I}_{\\mathrm{{PTAT}}} - {k}_{2}{I}_{{\\mathrm{V}}_{\\mathrm{{BE}}}} & {I}_{\\mathrm{{PTAT}}} > {I}_{{\\mathrm{V}}_{\\mathrm{{BE}}}} \\end{array}\\right.  \\tag{4 - 25}\n$$\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_86_190_260_1134_425_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_86_190_260_1134_425_0.jpg)\n图 4-5 非线性温度电压项的产生电路\n电路产生 ${I}_{\\mathrm{{NL}}}$ 的极性限制使该补偿方法在应用上受到限制。由于 ${I}_{\\mathrm{{NL}}}$ 只能在中高温区内有效,且为正温度系数,通常只能用于 ${V}_{\\text{ref }}\\left( T\\right)$ 温度特性开口向下的曲率补偿,如图 4-6 所示。 $A\\text{、}B\\text{、}C$ 为电路结构决定的比例系数。此时,一阶温度补偿中的 PTAT 电压应适当减小,使 ${V}_{\\text{ref }}$ 极值所对应的温度点向低温度区偏离,以提高二阶曲率补偿的效果。\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_86_934_978_298_377_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_86_934_978_298_377_0.jpg)\n图 4-7 基于 $\\beta$ 温度特性的补偿\n![0196aaa2-bbe2-70ee-823d-d4abf5c67805_86_268_1106_499_250_0.jpg](images/0196aaa2-bbe2-70ee-823d-d4abf5c67805_86_268_1106_499_250_0.jpg)\n图 4-6 温度曲率补偿示意图\n在 ${I}_{\\mathrm{{NL}}}$ 极性无法改变的前提下,通过改变在 ${I}_{\\mathrm{{NL}}}$ 注入输出支路的方式,由原先的并联相加叠加改变为并联相减叠加,则分段补偿结构同样可用于 ${V}_{\\text{ref }}\\left( T\\right)$ 温度特性开口向上的曲率补偿。因此,分段补偿是具有较优性能且实现结构最简单的一种高阶温度补偿方法,实用价值高。\n## 2)电流增益 $\\beta$ 因子补偿\n另一种非线性补偿利用 $\\mathrm{{PNP}}$ 管电流增益的非线性温度特性,即 ${I}_{\\mathrm{B}} = {I}_{\\mathrm{C}}/\\beta$ ,其中 $\\beta \\left( T\\right)$ $= {C}_{1}\\exp \\left( {-1/T}\\right)$ 。根据图 4-7 所示的基准结构,输出为\n$$\n{V}_{\\mathrm{{ref}}} = {V}_{\\mathrm{{BE}}} + \\left\\lbrack  {{a}_{1}T + \\frac{{a}_{2}T}{\\left( 1 + \\beta \\right) }}\\right\\rbrack  R \\approx  {V}_{\\mathrm{{ref}}}\\left( {T}_{0}\\right)  + {a}_{2}R\\frac{T}{\\beta } \\tag{4 - 26}\n$$\n其中 ${I}_{\\mathrm{{PTAT}}}$ 电流项 ${a}_{1}T$ 形成的 ${V}_{\\mathrm{{PTAT}}} = {a}_{1}{TR}$ 用于一阶线性补偿,形成一阶基准输出 ${V}_{\\text{ref }}$ $\\left( {T}_{0}\\right)$ ,而 $\\beta$ 的非线性温度项则用于二阶补偿,即\n$$\n{V}_{\\text{ref }}\\left( T\\right)  = {V}_{\\text{ref }}\\left( {T}_{0}\\right)  + {C}_{2}{RT}\\exp \\left( \\frac{1}{T}\\right)  \\tag{4 - 27}\n$$\n电流增益的温度系数给基准补偿带来负温度系数,但由于温度变化的指数关系,补偿量很难精确控制,有效作用范围小,因此应用受到限制。\n## 3)非线性检测补偿\n以上两种方法均属于非线性拟合型补偿,无法从根本上解决问题。如果对基准中残余的非线性量能够无失真地检测并提取出来,再用于基准的非线性补偿即可获得完全理想的补偿效果。非线性温度补偿电压 ${V}_{\\mathrm{{NL}}}$ 或电流 ${I}_{\\mathrm{{NL}}}$ 一般由不同温度特性的 $\\mathrm{{PN}}$ 结电压差检测提取得到。根据前文分析,由 $\\Delta {V}_{\\mathrm{{BE}}}$ 和电阻 $R$ 定义的 $\\mathrm{{PN}}$ 结电流,其不同的温度特性主要体现在 $\\alpha$ 系数的不同上。反过来看,当强制确定 ${I}_{\\mathrm{C}}$ 的温度特性后, $\\alpha$ 也相应被唯一确定。当设定 PTAT 电流,则 $\\alpha  = 1$ ,当设定零温度系数 (Temperature Independent) 电流,则 $\\alpha  = 0$ 。对于静态偏置点电流相同但温度特性不同的两个 $\\mathrm{{PN}}$ 结,其导通电压差为\n$$\n{V}_{\\mathrm{{BE}}}\\left( {I}_{\\mathrm{{PTAT}}}\\right)  - {V}_{\\mathrm{{BE}}}\\left( {I}_{\\mathrm{{TI}}}\\right)  = \\left\\lbrack  {{\\left( \\gamma  - \\alpha \\right) }_{\\mathrm{{TI}}} - {\\left( \\gamma  - \\alpha \\right) }_{\\mathrm{{PTAT}}}}\\right\\rbrack  {V}_{\\mathrm{T}}\\ln \\frac{T}{{T}_{0}} \\approx  {V}_{\\mathrm{T}}\\ln \\frac{T}{{T}_{0}} \\tag{4 - 28}\n$$\n该电压差将 ${V}_{\\mathrm{{BE}}}$ 中的主要非线性温度项原样提取出来,可用于精确的高阶温度特性补偿。 根据前文分析的相关结论,即高阶补偿中线性补偿与非线性补偿应相互配合的有关要求,需对高级补偿中的一阶线性补偿进行修正, ${V}_{\\mathrm{{PTAT}}}$ 的补偿电压为\n$$\n{V}_{\\mathrm{{PTAT}}} = {k}_{\\mathrm{m}}{V}_{\\mathrm{T}} = \\frac{{V}_{\\mathrm{g}0} - {V}_{\\mathrm{{BE}}0}}{{V}_{\\mathrm{T}0}}{V}_{\\mathrm{T}} = \\left( {{V}_{\\mathrm{g}0} - {V}_{\\mathrm{{BE}}0}}\\right) \\frac{T}{{T}_{0}} \\tag{4 - 29}\n$$\n相对单独一阶线性补偿的 ${V}_{\\mathrm{{PTAT}}}$ 电压减小了 $\\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}}$ 量,则经过一阶补偿后的电压基准由原来式 (4-10) 关系可得\n$$\n{V}_{\\text{ref }}\\left( T\\right)  = {V}_{\\mathrm{g}} - \\left( {\\gamma  - \\alpha }\\right) {V}_{\\mathrm{T}}\\ln \\frac{T}{{T}_{0}} \\tag{4 - 30}\n$$\n将式(4-28)得到的非线性电压经过适当的比例系数变化后,叠加到式(4-30)中,最终获得理想温度特性的基准电压输出。基于这种补偿原理的电路结构将在电流模带隙基准中进行分析。在以上高阶补偿中,应进一步考虑 ${V}_{\\mathrm{g}}\\left( T\\right)$ 的温度特性,实际的补偿精度才能有效提高。"
}